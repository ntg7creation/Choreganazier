import{r as Bt,g as Ic,a as Oc,s as Dc,_ as ls,u as _c,b as kc,e as Vc,c as zc,j as Oe,d as Fc,f as tn,h as fo,i as Uc,k as mo,l as $e,m as C,C as go,V as Ne,n as Se,o as Nt,M as Pc,p as ws,E as ei,q as ti,L as yo,S as Bc,U as Wc,I as Gc,t as Yc,v as Hc,w as $c,D as cs,x as qc,y as si,z as jc,F as Kc,W as ni,A as No,N as Ho,B as Xc,G as fs,H as oi,J as ri,K as Zc,O as Jc,P as $o,Q as Qc,R as eu,T as vt,X as qo,Y as tu,Z as su,$ as nu,a0 as ou,a1 as ru,a2 as iu,a3 as au,a4 as cu,a5 as uu,a6 as lu,a7 as du,a8 as jo,a9 as hu,aa as pu,ab as fu,ac as Rs,ad as ii,ae as mu,af as gu,ag as ai,ah as yu,ai as ci,aj as Nu,ak as vu,al as Tu,am as xu,an as wu,ao as bu,ap as Su,aq as Mu,ar as Eu,as as Au,at as ui,au as Ru,av as Cu,aw as Lu,ax as Iu,ay as Ou,az as Du}from"./index-DK9T8q7S.js";import{D as Ko}from"./Divider-CaJW0H0g.js";const Xo=Bt.createContext();function _u(n){return Ic("MuiGrid",n)}const ku=[0,1,2,3,4,5,6,7,8,9,10],Vu=["column-reverse","column","row-reverse","row"],zu=["nowrap","wrap-reverse","wrap"],ss=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],ms=Oc("MuiGrid",["root","container","item","zeroMinWidth",...ku.map(n=>`spacing-xs-${n}`),...Vu.map(n=>`direction-xs-${n}`),...zu.map(n=>`wrap-xs-${n}`),...ss.map(n=>`grid-xs-${n}`),...ss.map(n=>`grid-sm-${n}`),...ss.map(n=>`grid-md-${n}`),...ss.map(n=>`grid-lg-${n}`),...ss.map(n=>`grid-xl-${n}`)]),Fu=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function Wt(n){const e=parseFloat(n);return`${e}${String(n).replace(String(e),"")||"px"}`}function Uu({theme:n,ownerState:e}){let t;return n.breakpoints.keys.reduce((s,o)=>{let r={};if(e[o]&&(t=e[o]),!t)return s;if(t===!0)r={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(t==="auto")r={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const i=tn({values:e.columns,breakpoints:n.breakpoints.values}),a=typeof i=="object"?i[o]:i;if(a==null)return s;const c=`${Math.round(t/a*1e8)/1e6}%`;let u={};if(e.container&&e.item&&e.columnSpacing!==0){const l=n.spacing(e.columnSpacing);if(l!=="0px"){const h=`calc(${c} + ${Wt(l)})`;u={flexBasis:h,maxWidth:h}}}r=ls({flexBasis:c,flexGrow:0,maxWidth:c},u)}return n.breakpoints.values[o]===0?Object.assign(s,r):s[n.breakpoints.up(o)]=r,s},{})}function Pu({theme:n,ownerState:e}){const t=tn({values:e.direction,breakpoints:n.breakpoints.values});return fo({theme:n},t,s=>{const o={flexDirection:s};return s.indexOf("column")===0&&(o[`& > .${ms.item}`]={maxWidth:"none"}),o})}function li({breakpoints:n,values:e}){let t="";Object.keys(e).forEach(o=>{t===""&&e[o]!==0&&(t=o)});const s=Object.keys(n).sort((o,r)=>n[o]-n[r]);return s.slice(0,s.indexOf(t))}function Bu({theme:n,ownerState:e}){const{container:t,rowSpacing:s}=e;let o={};if(t&&s!==0){const r=tn({values:s,breakpoints:n.breakpoints.values});let i;typeof r=="object"&&(i=li({breakpoints:n.breakpoints.values,values:r})),o=fo({theme:n},r,(a,c)=>{var u;const l=n.spacing(a);return l!=="0px"?{marginTop:`-${Wt(l)}`,[`& > .${ms.item}`]:{paddingTop:Wt(l)}}:(u=i)!=null&&u.includes(c)?{}:{marginTop:0,[`& > .${ms.item}`]:{paddingTop:0}}})}return o}function Wu({theme:n,ownerState:e}){const{container:t,columnSpacing:s}=e;let o={};if(t&&s!==0){const r=tn({values:s,breakpoints:n.breakpoints.values});let i;typeof r=="object"&&(i=li({breakpoints:n.breakpoints.values,values:r})),o=fo({theme:n},r,(a,c)=>{var u;const l=n.spacing(a);return l!=="0px"?{width:`calc(100% + ${Wt(l)})`,marginLeft:`-${Wt(l)}`,[`& > .${ms.item}`]:{paddingLeft:Wt(l)}}:(u=i)!=null&&u.includes(c)?{}:{width:"100%",marginLeft:0,[`& > .${ms.item}`]:{paddingLeft:0}}})}return o}function Gu(n,e,t={}){if(!n||n<=0)return[];if(typeof n=="string"&&!Number.isNaN(Number(n))||typeof n=="number")return[t[`spacing-xs-${String(n)}`]];const s=[];return e.forEach(o=>{const r=n[o];Number(r)>0&&s.push(t[`spacing-${o}-${String(r)}`])}),s}const Yu=Dc("div",{name:"MuiGrid",slot:"Root",overridesResolver:(n,e)=>{const{ownerState:t}=n,{container:s,direction:o,item:r,spacing:i,wrap:a,zeroMinWidth:c,breakpoints:u}=t;let l=[];s&&(l=Gu(i,u,e));const h=[];return u.forEach(d=>{const m=t[d];m&&h.push(e[`grid-${d}-${String(m)}`])}),[e.root,s&&e.container,r&&e.item,c&&e.zeroMinWidth,...l,o!=="row"&&e[`direction-xs-${String(o)}`],a!=="wrap"&&e[`wrap-xs-${String(a)}`],...h]}})(({ownerState:n})=>ls({boxSizing:"border-box"},n.container&&{display:"flex",flexWrap:"wrap",width:"100%"},n.item&&{margin:0},n.zeroMinWidth&&{minWidth:0},n.wrap!=="wrap"&&{flexWrap:n.wrap}),Pu,Bu,Wu,Uu);function Hu(n,e){if(!n||n<=0)return[];if(typeof n=="string"&&!Number.isNaN(Number(n))||typeof n=="number")return[`spacing-xs-${String(n)}`];const t=[];return e.forEach(s=>{const o=n[s];if(Number(o)>0){const r=`spacing-${s}-${String(o)}`;t.push(r)}}),t}const $u=n=>{const{classes:e,container:t,direction:s,item:o,spacing:r,wrap:i,zeroMinWidth:a,breakpoints:c}=n;let u=[];t&&(u=Hu(r,c));const l=[];c.forEach(d=>{const m=n[d];m&&l.push(`grid-${d}-${String(m)}`)});const h={root:["root",t&&"container",o&&"item",a&&"zeroMinWidth",...u,s!=="row"&&`direction-xs-${String(s)}`,i!=="wrap"&&`wrap-xs-${String(i)}`,...l]};return Uc(h,_u,e)},Zo=Bt.forwardRef(function(e,t){const s=_c({props:e,name:"MuiGrid"}),{breakpoints:o}=kc(),r=Vc(s),{className:i,columns:a,columnSpacing:c,component:u="div",container:l=!1,direction:h="row",item:d=!1,rowSpacing:m,spacing:y=0,wrap:x="wrap",zeroMinWidth:S=!1}=r,R=zc(r,Fu),O=m||y,I=c||y,j=Bt.useContext(Xo),U=l?a||12:j,z={},G=ls({},R);o.keys.forEach(Be=>{R[Be]!=null&&(z[Be]=R[Be],delete G[Be])});const F=ls({},r,{columns:U,container:l,direction:h,item:d,rowSpacing:O,columnSpacing:I,wrap:x,zeroMinWidth:S,spacing:y},z,{breakpoints:o.keys}),Pe=$u(F);return Oe.jsx(Xo.Provider,{value:U,children:Oe.jsx(Yu,ls({ownerState:F,className:Fc(Pe.root,i),as:u,ref:t},G))})});var Bn=["MO","TU","WE","TH","FR","SA","SU"],we=function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(Bn.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=Bn[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n}(),ne=function(n){return n!=null},je=function(n){return typeof n=="number"},Jo=function(n){return typeof n=="string"&&Bn.includes(n)},ke=Array.isArray,ot=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],s=n;s<e;s++)t.push(s);return t},P=function(n,e){var t=0,s=[];if(ke(n))for(;t<e;t++)s[t]=[].concat(n);else for(;t<e;t++)s[t]=n;return s},qu=function(n){return ke(n)?n:[n]};function kt(n,e,t){t===void 0&&(t=" ");var s=String(n);return e=e>>0,s.length>e?String(s):(e=e-s.length,e>t.length&&(t+=P(t,e/t.length)),t.slice(0,e)+String(s))}var ju=function(n,e,t){var s=n.split(e);return t?s.slice(0,t).concat([s.slice(t).join(e)]):s},ze=function(n,e){var t=n%e;return t*e<0?t+e:t},vn=function(n,e){return{div:Math.floor(n/e),mod:ze(n,e)}},Xe=function(n){return!ne(n)||n.length===0},ce=function(n){return!Xe(n)},Z=function(n,e){return ce(n)&&n.indexOf(e)!==-1},Et=function(n,e,t,s,o,r){return s===void 0&&(s=0),o===void 0&&(o=0),r===void 0&&(r=0),new Date(Date.UTC(n,e-1,t,s,o,r))},Ku=[31,28,31,30,31,30,31,31,30,31,30,31],di=1e3*60*60*24,hi=9999,pi=Et(1970,1,1),Xu=[6,0,1,2,3,4,5],ds=function(n){return n%4===0&&n%100!==0||n%400===0},fi=function(n){return n instanceof Date},us=function(n){return fi(n)&&!isNaN(n.getTime())},Zu=function(n,e){var t=n.getTime(),s=e.getTime(),o=t-s;return Math.round(o/di)},Wn=function(n){return Zu(n,pi)},mi=function(n){return new Date(pi.getTime()+n*di)},Ju=function(n){var e=n.getUTCMonth();return e===1&&ds(n.getUTCFullYear())?29:Ku[e]},Kt=function(n){return Xu[n.getUTCDay()]},Qo=function(n,e){var t=Et(n,e+1,1);return[Kt(t),Ju(t)]},gi=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},Gn=function(n){var e=new Date(n.getTime());return e},er=function(n){for(var e=[],t=0;t<n.length;t++)e.push(Gn(n[t]));return e},gs=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},vo=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[kt(t.getUTCFullYear().toString(),4,"0"),kt(t.getUTCMonth()+1,2,"0"),kt(t.getUTCDate(),2,"0"),"T",kt(t.getUTCHours(),2,"0"),kt(t.getUTCMinutes(),2,"0"),kt(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},To=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},tr=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},Qu=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,s=new Date(tr(n,t)),o=new Date(tr(n,e??"UTC")),r=o.getTime()-s.getTime();return new Date(n.getTime()-r)},Vt=function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,s=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(s)return!1}else if(this.method==="before"){if(s)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n}(),sr=function(n){mo(e,n);function e(t,s,o){var r=n.call(this,t,s)||this;return r.iterator=o,r}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e}(Vt),Ps={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},nr=function(n,e){return n.indexOf(e)!==-1},el=function(n){return n.toString()},tl=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},pt=function(){function n(e,t,s,o){if(t===void 0&&(t=el),s===void 0&&(s=Ps),o===void 0&&(o=tl),this.text=[],this.language=s||Ps,this.gettext=t,this.dateFormatter=o,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var r=[].concat(this.options.bymonthday),i=[].concat(this.options.bynmonthday);r.sort(function(l,h){return l-h}),i.sort(function(l,h){return h-l}),this.bymonthday=r.concat(i),this.bymonthday.length||(this.bymonthday=null)}if(ne(this.origOptions.byweekday)){var a=ke(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],c=String(a);this.byweekday={allWeeks:a.filter(function(l){return!l.n}),someWeeks:a.filter(function(l){return!!l.n}),isWeekdays:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")===-1&&c.indexOf("SU")===-1,isEveryDay:c.indexOf("MO")!==-1&&c.indexOf("TU")!==-1&&c.indexOf("WE")!==-1&&c.indexOf("TH")!==-1&&c.indexOf("FR")!==-1&&c.indexOf("SA")!==-1&&c.indexOf("SU")!==-1};var u=function(l,h){return l.weekday-h.weekday};this.byweekday.allWeeks.sort(u),this.byweekday.someWeeks.sort(u),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var s in e.origOptions){if(nr(["dtstart","tzid","wkst","freq"],s))return!0;if(!nr(n.IMPLEMENTED[e.options.freq],s))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[_.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,s=this.gettext;if(e===-1)return s("last");var o=Math.abs(e);switch(o){case 1:case 21:case 31:t=o+s("st");break;case 2:case 22:t=o+s("nd");break;case 3:case 23:t=o+s("rd");break;default:t=o+s("th")}return e<0?t+" "+s("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=je(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,s,o){var r=this;o===void 0&&(o=","),ke(e)||(e=[e]);var i=function(c,u,l){for(var h="",d=0;d<c.length;d++)d!==0&&(d===c.length-1?h+=" "+l+" ":h+=u+" "),h+=c[d];return h};t=t||function(c){return c.toString()};var a=function(c){return t&&t.call(r,c)};return s?i(e.map(a),o,s):e.map(a).join(o+" ")},n}(),sl=function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var s=void 0;e=null;for(var o in this.rules){s=this.rules[o];var r=s.exec(this.text);r&&(e===null||r[0].length>e[0].length)&&(e=r,t=o)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n}();function yi(n,e){e===void 0&&(e=Ps);var t={},s=new sl(e.tokens);if(!s.start(n))return null;return o(),t;function o(){s.expect("every");var d=s.acceptNumber();if(d&&(t.interval=parseInt(d[0],10)),s.isDone())throw new Error("Unexpected end");switch(s.symbol){case"day(s)":t.freq=_.DAILY,s.nextSymbol()&&(i(),h());break;case"weekday(s)":t.freq=_.WEEKLY,t.byweekday=[_.MO,_.TU,_.WE,_.TH,_.FR],s.nextSymbol(),i(),h();break;case"week(s)":t.freq=_.WEEKLY,s.nextSymbol()&&(r(),i(),h());break;case"hour(s)":t.freq=_.HOURLY,s.nextSymbol()&&(r(),h());break;case"minute(s)":t.freq=_.MINUTELY,s.nextSymbol()&&(r(),h());break;case"month(s)":t.freq=_.MONTHLY,s.nextSymbol()&&(r(),h());break;case"year(s)":t.freq=_.YEARLY,s.nextSymbol()&&(r(),h());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=_.WEEKLY;var m=s.symbol.substr(0,2).toUpperCase();if(t.byweekday=[_[m]],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var y=c();if(!y)throw new Error("Unexpected symbol "+s.symbol+", expected weekday");t.byweekday.push(_[y]),s.nextSymbol()}i(),l(),h();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=_.YEARLY,t.bymonth=[a()],!s.nextSymbol())return;for(;s.accept("comma");){if(s.isDone())throw new Error("Unexpected end");var x=a();if(!x)throw new Error("Unexpected symbol "+s.symbol+", expected month");t.bymonth.push(x),s.nextSymbol()}r(),h();break;default:throw new Error("Unknown symbol")}}function r(){var d=s.accept("on"),m=s.accept("the");if(d||m)do{var y=u(),x=c(),S=a();if(y)x?(s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(_[x].nth(y))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(y),s.accept("day(s)"));else if(x)s.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(_[x]);else if(s.symbol==="weekday(s)")s.nextSymbol(),t.byweekday||(t.byweekday=[_.MO,_.TU,_.WE,_.TH,_.FR]);else if(s.symbol==="week(s)"){s.nextSymbol();var R=s.acceptNumber();if(!R)throw new Error("Unexpected symbol "+s.symbol+", expected week number");for(t.byweekno=[parseInt(R[0],10)];s.accept("comma");){if(R=s.acceptNumber(),!R)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.byweekno.push(parseInt(R[0],10))}}else if(S)s.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(S);else return}while(s.accept("comma")||s.accept("the")||s.accept("on"))}function i(){var d=s.accept("at");if(d)do{var m=s.acceptNumber();if(!m)throw new Error("Unexpected symbol "+s.symbol+", expected hour");for(t.byhour=[parseInt(m[0],10)];s.accept("comma");){if(m=s.acceptNumber(),!m)throw new Error("Unexpected symbol "+s.symbol+"; expected hour");t.byhour.push(parseInt(m[0],10))}}while(s.accept("comma")||s.accept("at"))}function a(){switch(s.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function c(){switch(s.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return s.symbol.substr(0,2).toUpperCase();default:return!1}}function u(){switch(s.symbol){case"last":return s.nextSymbol(),-1;case"first":return s.nextSymbol(),1;case"second":return s.nextSymbol(),s.accept("last")?-2:2;case"third":return s.nextSymbol(),s.accept("last")?-3:3;case"nth":var d=parseInt(s.value[1],10);if(d<-366||d>366)throw new Error("Nth out of range: "+d);return s.nextSymbol(),s.accept("last")?-d:d;default:return!1}}function l(){s.accept("on"),s.accept("the");var d=u();if(d)for(t.bymonthday=[d],s.nextSymbol();s.accept("comma");){if(d=u(),!d)throw new Error("Unexpected symbol "+s.symbol+"; expected monthday");t.bymonthday.push(d),s.nextSymbol()}}function h(){if(s.symbol==="until"){var d=Date.parse(s.text);if(!d)throw new Error("Cannot parse until date:"+s.text);t.until=new Date(d)}else s.accept("for")&&(t.count=parseInt(s.value[0],10),s.expect("number"))}}var B;(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(B||(B={}));function xo(n){return n<B.HOURLY}var nl=function(n,e){return e===void 0&&(e=Ps),new _(yi(n,e)||void 0)},Jt=["count","until","interval","byweekday","bymonthday","bymonth"];pt.IMPLEMENTED=[];pt.IMPLEMENTED[B.HOURLY]=Jt;pt.IMPLEMENTED[B.MINUTELY]=Jt;pt.IMPLEMENTED[B.DAILY]=["byhour"].concat(Jt);pt.IMPLEMENTED[B.WEEKLY]=Jt;pt.IMPLEMENTED[B.MONTHLY]=Jt;pt.IMPLEMENTED[B.YEARLY]=["byweekno","byyearday"].concat(Jt);var ol=function(n,e,t,s){return new pt(n,e,t,s).toString()},rl=pt.isFullyConvertible,Bs=function(){function n(e,t,s,o){this.hour=e,this.minute=t,this.second=s,this.millisecond=o||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n}(),il=function(n){mo(e,n);function e(t,s,o,r,i,a,c){var u=n.call(this,r,i,a,c)||this;return u.year=t,u.month=s,u.day=o,u}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return Kt(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var s=Math.floor(this.month/12),o=ze(this.month,12);this.month=o,this.year+=s,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,s){s>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-s))+t*7:this.day+=-(this.getWeekday()-s)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,s,o){for(s&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var r=vn(this.hour,24),i=r.div,a=r.mod;if(i&&(this.hour=a,this.addDaily(i)),Xe(o)||Z(o,this.hour))break}},e.prototype.addMinutes=function(t,s,o,r){for(s&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var i=vn(this.minute,60),a=i.div,c=i.mod;if(a&&(this.minute=c,this.addHours(a,!1,o)),(Xe(o)||Z(o,this.hour))&&(Xe(r)||Z(r,this.minute)))break}},e.prototype.addSeconds=function(t,s,o,r,i){for(s&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var a=vn(this.second,60),c=a.div,u=a.mod;if(c&&(this.second=u,this.addMinutes(c,!1,o,r)),(Xe(o)||Z(o,this.hour))&&(Xe(r)||Z(r,this.minute))&&(Xe(i)||Z(i,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=Qo(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>hi))return;t=Qo(this.year,this.month-1)[1]}}},e.prototype.add=function(t,s){var o=t.freq,r=t.interval,i=t.wkst,a=t.byhour,c=t.byminute,u=t.bysecond;switch(o){case B.YEARLY:return this.addYears(r);case B.MONTHLY:return this.addMonths(r);case B.WEEKLY:return this.addWeekly(r,i);case B.DAILY:return this.addDaily(r);case B.HOURLY:return this.addHours(r,s,a);case B.MINUTELY:return this.addMinutes(r,s,a,c);case B.SECONDLY:return this.addSeconds(r,s,a,c,u)}},e}(Bs);function Ni(n){for(var e=[],t=Object.keys(n),s=0,o=t;s<o.length;s++){var r=o[s];Z(Vl,r)||e.push(r),fi(n[r])&&!us(n[r])&&e.push(r)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return $e({},n)}function al(n){var e=$e($e({},wo),Ni(n));if(ne(e.byeaster)&&(e.freq=_.YEARLY),!(ne(e.freq)&&_.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),ne(e.wkst)?je(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=_.MO.weekday,ne(e.bysetpos)){je(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var s=e.bysetpos[t];if(s===0||!(s>=-366&&s<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||ce(e.byweekno)||ce(e.byyearday)||e.bymonthday||ce(e.bymonthday)||ne(e.byweekday)||ne(e.byeaster)))switch(e.freq){case _.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case _.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case _.WEEKLY:e.byweekday=[Kt(e.dtstart)];break}if(ne(e.bymonth)&&!ke(e.bymonth)&&(e.bymonth=[e.bymonth]),ne(e.byyearday)&&!ke(e.byyearday)&&je(e.byyearday)&&(e.byyearday=[e.byyearday]),!ne(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(ke(e.bymonthday)){for(var o=[],r=[],t=0;t<e.bymonthday.length;t++){var s=e.bymonthday[t];s>0?o.push(s):s<0&&r.push(s)}e.bymonthday=o,e.bynmonthday=r}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(ne(e.byweekno)&&!ke(e.byweekno)&&(e.byweekno=[e.byweekno]),!ne(e.byweekday))e.bynweekday=null;else if(je(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(Jo(e.byweekday))e.byweekday=[we.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof we)!e.byweekday.n||e.freq>_.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var i=[],a=[],t=0;t<e.byweekday.length;t++){var c=e.byweekday[t];if(je(c)){i.push(c);continue}else if(Jo(c)){i.push(we.fromStr(c).weekday);continue}!c.n||e.freq>_.MONTHLY?i.push(c.weekday):a.push([c.weekday,c.n])}e.byweekday=ce(i)?i:null,e.bynweekday=ce(a)?a:null}return ne(e.byhour)?je(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<_.HOURLY?[e.dtstart.getUTCHours()]:null,ne(e.byminute)?je(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<_.MINUTELY?[e.dtstart.getUTCMinutes()]:null,ne(e.bysecond)?je(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<_.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function cl(n){var e=n.dtstart.getTime()%1e3;if(!xo(n.freq))return[];var t=[];return n.byhour.forEach(function(s){n.byminute.forEach(function(o){n.bysecond.forEach(function(r){t.push(new Bs(s,o,r,e))})})}),t}function Yn(n){var e=n.split(`
`).map(ul).filter(function(t){return t!==null});return $e($e({},e[0]),e[1])}function Ws(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var s=t[1],o=t[2];return s&&(e.tzid=s),e.dtstart=To(o),e}function ul(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return or(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return or(n);case"DTSTART":return Ws(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function or(n){var e=n.replace(/^RRULE:/i,""),t=Ws(e),s=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return s.forEach(function(o){var r=o.split("="),i=r[0],a=r[1];switch(i.toUpperCase()){case"FREQ":t.freq=B[a.toUpperCase()];break;case"WKST":t.wkst=Ge[a.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var c=ll(a),u=i.toLowerCase();t[u]=c;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=dl(a);break;case"DTSTART":case"TZID":var l=Ws(n);t.tzid=l.tzid,t.dtstart=l.dtstart;break;case"UNTIL":t.until=To(a);break;case"BYEASTER":t.byeaster=Number(a);break;default:throw new Error("Unknown RRULE property '"+i+"'")}}),t}function ll(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(rr)}return rr(n)}function rr(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function dl(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Ge[t];var s=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!s||s.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var o=Number(s[1]),r=s[2],i=Ge[r].weekday;return new we(i,o)})}var Gs=function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=vo(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:Qu(this.date,this.tzid)},n}();function Hn(n){for(var e=[],t="",s=Object.keys(n),o=Object.keys(wo),r=0;r<s.length;r++)if(s[r]!=="tzid"&&Z(o,s[r])){var i=s[r].toUpperCase(),a=n[s[r]],c="";if(!(!ne(a)||ke(a)&&!a.length)){switch(i){case"FREQ":c=_.FREQUENCIES[n.freq];break;case"WKST":je(a)?c=new we(a).toString():c=a.toString();break;case"BYWEEKDAY":i="BYDAY",c=qu(a).map(function(m){return m instanceof we?m:ke(m)?new we(m[0],m[1]):new we(m)}).toString();break;case"DTSTART":t=hl(a,n.tzid);break;case"UNTIL":c=vo(a,!n.tzid);break;default:if(ke(a)){for(var u=[],l=0;l<a.length;l++)u[l]=String(a[l]);c=u.toString()}else c=String(a)}c&&e.push([i,c])}}var h=e.map(function(m){var y=m[0],x=m[1];return"".concat(y,"=").concat(x.toString())}).join(";"),d="";return h!==""&&(d="RRULE:".concat(h)),[t,d].filter(function(m){return!!m}).join(`
`)}function hl(n,e){return n?"DTSTART"+new Gs(new Date(n),e).toString():""}function pl(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,s){return t.getTime()===e[s].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var fl=function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,s){t&&(t=t instanceof Date?Gn(t):er(t)),e==="all"?this.all=t:(s._value=t,this[e].push(s))},n.prototype._cacheGet=function(e,t){var s=!1,o=t?Object.keys(t):[],r=function(l){for(var h=0;h<o.length;h++){var d=o[h];if(!pl(t[d],l[d]))return!0}return!1},i=this[e];if(e==="all")s=this.all;else if(ke(i))for(var a=0;a<i.length;a++){var c=i[a];if(!(o.length&&r(c))){s=c._value;break}}if(!s&&this.all){for(var u=new Vt(e,t),a=0;a<this.all.length&&u.accept(this.all[a]);a++);s=u.getValue(),this._cacheAdd(e,s,t)}return ke(s)?er(s):s instanceof Date?Gn(s):s},n}(),ml=C(C(C(C(C(C(C(C(C(C(C(C(C([],P(1,31),!0),P(2,28),!0),P(3,31),!0),P(4,30),!0),P(5,31),!0),P(6,30),!0),P(7,31),!0),P(8,31),!0),P(9,30),!0),P(10,31),!0),P(11,30),!0),P(12,31),!0),P(1,7),!0),gl=C(C(C(C(C(C(C(C(C(C(C(C(C([],P(1,31),!0),P(2,29),!0),P(3,31),!0),P(4,30),!0),P(5,31),!0),P(6,30),!0),P(7,31),!0),P(8,31),!0),P(9,30),!0),P(10,31),!0),P(11,30),!0),P(12,31),!0),P(1,7),!0),yl=ot(1,29),Nl=ot(1,30),mt=ot(1,31),fe=ot(1,32),vl=C(C(C(C(C(C(C(C(C(C(C(C(C([],fe,!0),Nl,!0),fe,!0),mt,!0),fe,!0),mt,!0),fe,!0),fe,!0),mt,!0),fe,!0),mt,!0),fe,!0),fe.slice(0,7),!0),Tl=C(C(C(C(C(C(C(C(C(C(C(C(C([],fe,!0),yl,!0),fe,!0),mt,!0),fe,!0),mt,!0),fe,!0),fe,!0),mt,!0),fe,!0),mt,!0),fe,!0),fe.slice(0,7),!0),xl=ot(-28,0),wl=ot(-29,0),gt=ot(-30,0),me=ot(-31,0),bl=C(C(C(C(C(C(C(C(C(C(C(C(C([],me,!0),wl,!0),me,!0),gt,!0),me,!0),gt,!0),me,!0),me,!0),gt,!0),me,!0),gt,!0),me,!0),me.slice(0,7),!0),Sl=C(C(C(C(C(C(C(C(C(C(C(C(C([],me,!0),xl,!0),me,!0),gt,!0),me,!0),gt,!0),me,!0),me,!0),gt,!0),me,!0),gt,!0),me,!0),me.slice(0,7),!0),Ml=[0,31,60,91,121,152,182,213,244,274,305,335,366],El=[0,31,59,90,120,151,181,212,243,273,304,334,365],ir=function(){for(var n=[],e=0;e<55;e++)n=n.concat(ot(7));return n}();function Al(n,e){var t=Et(n,1,1),s=ds(n)?366:365,o=ds(n+1)?366:365,r=Wn(t),i=Kt(t),a=$e($e({yearlen:s,nextyearlen:o,yearordinal:r,yearweekday:i},Rl(n)),{wnomask:null});if(Xe(e.byweekno))return a;a.wnomask=P(0,s+7);var c,u,l=c=ze(7-i+e.wkst,7);l>=4?(l=0,u=a.yearlen+ze(i-e.wkst,7)):u=s-l;for(var h=Math.floor(u/7),d=ze(u,7),m=Math.floor(h+d/4),y=0;y<e.byweekno.length;y++){var x=e.byweekno[y];if(x<0&&(x+=m+1),x>0&&x<=m){var S=void 0;x>1?(S=l+(x-1)*7,l!==c&&(S-=7-c)):S=l;for(var R=0;R<7&&(a.wnomask[S]=1,S++,a.wdaymask[S]!==e.wkst);R++);}}if(Z(e.byweekno,1)){var S=l+m*7;if(l!==c&&(S-=7-c),S<s)for(var y=0;y<7&&(a.wnomask[S]=1,S+=1,a.wdaymask[S]!==e.wkst);y++);}if(l){var O=void 0;if(Z(e.byweekno,-1))O=-1;else{var I=Kt(Et(n-1,1,1)),j=ze(7-I.valueOf()+e.wkst,7),U=ds(n-1)?366:365,z=void 0;j>=4?(j=0,z=U+ze(I-e.wkst,7)):z=s-l,O=Math.floor(52+ze(z,7)/4)}if(Z(e.byweekno,O))for(var S=0;S<l;S++)a.wnomask[S]=1}return a}function Rl(n){var e=ds(n)?366:365,t=Et(n,1,1),s=Kt(t);return e===365?{mmask:ml,mdaymask:Tl,nmdaymask:Sl,wdaymask:ir.slice(s),mrange:El}:{mmask:gl,mdaymask:vl,nmdaymask:bl,wdaymask:ir.slice(s),mrange:Ml}}function Cl(n,e,t,s,o,r){var i={lastyear:n,lastmonth:e,nwdaymask:[]},a=[];if(r.freq===_.YEARLY)if(Xe(r.bymonth))a=[[0,t]];else for(var c=0;c<r.bymonth.length;c++)e=r.bymonth[c],a.push(s.slice(e-1,e+1));else r.freq===_.MONTHLY&&(a=[s.slice(e-1,e+1)]);if(Xe(a))return i;i.nwdaymask=P(0,t);for(var c=0;c<a.length;c++)for(var u=a[c],l=u[0],h=u[1]-1,d=0;d<r.bynweekday.length;d++){var m=void 0,y=r.bynweekday[d],x=y[0],S=y[1];S<0?(m=h+(S+1)*7,m-=ze(o[m]-x,7)):(m=l+(S-1)*7,m+=ze(7-o[m]+x,7)),l<=m&&m<=h&&(i.nwdaymask[m]=1)}return i}function Ll(n,e){e===void 0&&(e=0);var t=n%19,s=Math.floor(n/100),o=n%100,r=Math.floor(s/4),i=s%4,a=Math.floor((s+8)/25),c=Math.floor((s-a+1)/3),u=Math.floor(19*t+s-r-c+15)%30,l=Math.floor(o/4),h=o%4,d=Math.floor(32+2*i+2*l-u-h)%7,m=Math.floor((t+11*u+22*d)/451),y=Math.floor((u+d-7*m+114)/31),x=(u+d-7*m+114)%31+1,S=Date.UTC(n,y-1,x+e),R=Date.UTC(n,0,1);return[Math.ceil((S-R)/(1e3*60*60*24))]}var Il=function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var s=this.options;if(e!==this.lastyear&&(this.yearinfo=Al(e,s)),ce(s.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var o=this.yearinfo,r=o.yearlen,i=o.mrange,a=o.wdaymask;this.monthinfo=Cl(e,t,r,i,a,s)}ne(s.byeaster)&&(this.eastermask=Ll(e,s.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[ot(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var s=this.mrange[t-1],o=this.mrange[t],r=P(null,this.yearlen),i=s;i<o;i++)r[i]=i;return[r,s,o]},n.prototype.wdayset=function(e,t,s){for(var o=P(null,this.yearlen+7),r=Wn(Et(e,t,s))-this.yearordinal,i=r,a=0;a<7&&(o[r]=r,++r,this.wdaymask[r]!==this.options.wkst);a++);return[o,i,r]},n.prototype.ddayset=function(e,t,s){var o=P(null,this.yearlen),r=Wn(Et(e,t,s))-this.yearordinal;return o[r]=r,[o,r,r+1]},n.prototype.htimeset=function(e,t,s,o){var r=this,i=[];return this.options.byminute.forEach(function(a){i=i.concat(r.mtimeset(e,a,s,o))}),gs(i),i},n.prototype.mtimeset=function(e,t,s,o){var r=this.options.bysecond.map(function(i){return new Bs(e,t,i,o)});return gs(r),r},n.prototype.stimeset=function(e,t,s,o){return[new Bs(e,t,s,o)]},n.prototype.getdayset=function(e){switch(e){case B.YEARLY:return this.ydayset.bind(this);case B.MONTHLY:return this.mdayset.bind(this);case B.WEEKLY:return this.wdayset.bind(this);case B.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case B.HOURLY:return this.htimeset.bind(this);case B.MINUTELY:return this.mtimeset.bind(this);case B.SECONDLY:return this.stimeset.bind(this)}},n}();function Ol(n,e,t,s,o,r){for(var i=[],a=0;a<n.length;a++){var c=void 0,u=void 0,l=n[a];l<0?(c=Math.floor(l/e.length),u=ze(l,e.length)):(c=Math.floor((l-1)/e.length),u=ze(l-1,e.length));for(var h=[],d=t;d<s;d++){var m=r[d];ne(m)&&h.push(m)}var y=void 0;c<0?y=h.slice(c)[0]:y=h[c];var x=e[u],S=mi(o.yearordinal+y),R=gi(S,x);Z(i,R)||i.push(R)}return gs(i),i}function vi(n,e){var t=e.dtstart,s=e.freq,o=e.interval,r=e.until,i=e.bysetpos,a=e.count;if(a===0||o===0)return it(n);var c=il.fromDate(t),u=new Il(e);u.rebuild(c.year,c.month);for(var l=kl(u,c,e);;){var h=u.getdayset(s)(c.year,c.month,c.day),d=h[0],m=h[1],y=h[2],x=_l(d,m,y,u,e);if(ce(i))for(var S=Ol(i,l,m,y,u,d),R=0;R<S.length;R++){var O=S[R];if(r&&O>r)return it(n);if(O>=t){var I=ar(O,e);if(!n.accept(I)||a&&(--a,!a))return it(n)}}else for(var R=m;R<y;R++){var j=d[R];if(ne(j))for(var U=mi(u.yearordinal+j),z=0;z<l.length;z++){var G=l[z],O=gi(U,G);if(r&&O>r)return it(n);if(O>=t){var I=ar(O,e);if(!n.accept(I)||a&&(--a,!a))return it(n)}}}if(e.interval===0||(c.add(e,x),c.year>hi))return it(n);xo(s)||(l=u.gettimeset(s)(c.hour,c.minute,c.second,0)),u.rebuild(c.year,c.month)}}function Dl(n,e,t){var s=t.bymonth,o=t.byweekno,r=t.byweekday,i=t.byeaster,a=t.bymonthday,c=t.bynmonthday,u=t.byyearday;return ce(s)&&!Z(s,n.mmask[e])||ce(o)&&!n.wnomask[e]||ce(r)&&!Z(r,n.wdaymask[e])||ce(n.nwdaymask)&&!n.nwdaymask[e]||i!==null&&!Z(n.eastermask,e)||(ce(a)||ce(c))&&!Z(a,n.mdaymask[e])&&!Z(c,n.nmdaymask[e])||ce(u)&&(e<n.yearlen&&!Z(u,e+1)&&!Z(u,-n.yearlen+e)||e>=n.yearlen&&!Z(u,e+1-n.yearlen)&&!Z(u,-n.nextyearlen+e-n.yearlen))}function ar(n,e){return new Gs(n,e.tzid).rezonedDate()}function it(n){return n.getValue()}function _l(n,e,t,s,o){for(var r=!1,i=e;i<t;i++){var a=n[i];r=Dl(s,a,o),r&&(n[a]=null)}return r}function kl(n,e,t){var s=t.freq,o=t.byhour,r=t.byminute,i=t.bysecond;return xo(s)?cl(t):s>=_.HOURLY&&ce(o)&&!Z(o,e.hour)||s>=_.MINUTELY&&ce(r)&&!Z(r,e.minute)||s>=_.SECONDLY&&ce(i)&&!Z(i,e.second)?[]:n.gettimeset(s)(e.hour,e.minute,e.second,e.millisecond)}var Ge={MO:new we(0),TU:new we(1),WE:new we(2),TH:new we(3),FR:new we(4),SA:new we(5),SU:new we(6)},wo={freq:B.YEARLY,dtstart:null,interval:1,wkst:Ge.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},Vl=Object.keys(wo),_=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new fl,this.origOptions=Ni(e);var s=al(e).parsedOptions;this.options=s}return n.parseText=function(e,t){return yi(e,t)},n.fromText=function(e,t){return nl(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return vi(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,s){if(this._cache)return this._cache._cacheAdd(e,t,s)},n.prototype.all=function(e){if(e)return this._iter(new sr("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new Vt("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,s,o){if(s===void 0&&(s=!1),!us(e)||!us(t))throw new Error("Invalid date passed in to RRule.between");var r={before:t,after:e,inc:s};if(o)return this._iter(new sr("between",r,o));var i=this._cacheGet("between",r);return i===!1&&(i=this._iter(new Vt("between",r)),this._cacheAdd("between",i,r)),i},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!us(e))throw new Error("Invalid date passed in to RRule.before");var s={dt:e,inc:t},o=this._cacheGet("before",s);return o===!1&&(o=this._iter(new Vt("before",s)),this._cacheAdd("before",o,s)),o},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!us(e))throw new Error("Invalid date passed in to RRule.after");var s={dt:e,inc:t},o=this._cacheGet("after",s);return o===!1&&(o=this._iter(new Vt("after",s)),this._cacheAdd("after",o,s)),o},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return Hn(this.origOptions)},n.prototype.toText=function(e,t,s){return ol(this,e,t,s)},n.prototype.isFullyConvertibleToText=function(){return rl(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=B.YEARLY,n.MONTHLY=B.MONTHLY,n.WEEKLY=B.WEEKLY,n.DAILY=B.DAILY,n.HOURLY=B.HOURLY,n.MINUTELY=B.MINUTELY,n.SECONDLY=B.SECONDLY,n.MO=Ge.MO,n.TU=Ge.TU,n.WE=Ge.WE,n.TH=Ge.TH,n.FR=Ge.FR,n.SA=Ge.SA,n.SU=Ge.SU,n.parseString=Yn,n.optionsToString=Hn,n}();function zl(n,e,t,s,o,r){var i={},a=n.accept;function c(d,m){t.forEach(function(y){y.between(d,m,!0).forEach(function(x){i[Number(x)]=!0})})}o.forEach(function(d){var m=new Gs(d,r).rezonedDate();i[Number(m)]=!0}),n.accept=function(d){var m=Number(d);return isNaN(m)?a.call(this,d):!i[m]&&(c(new Date(m-1),new Date(m+1)),!i[m])?(i[m]=!0,a.call(this,d)):!0},n.method==="between"&&(c(n.args.after,n.args.before),n.accept=function(d){var m=Number(d);return i[m]?!0:(i[m]=!0,a.call(this,d))});for(var u=0;u<s.length;u++){var l=new Gs(s[u],r).rezonedDate();if(!n.accept(new Date(l.getTime())))break}e.forEach(function(d){vi(n,d.options)});var h=n._result;switch(gs(h),n.method){case"all":case"between":return h;case"before":return h.length&&h[h.length-1]||null;case"after":default:return h.length&&h[0]||null}}var cr={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null};function Fl(n,e){var t=[],s=[],o=[],r=[],i=Ws(n),a=i.dtstart,c=i.tzid,u=Gl(n,e.unfold);return u.forEach(function(l){var h;if(l){var d=Wl(l),m=d.name,y=d.parms,x=d.value;switch(m.toUpperCase()){case"RRULE":if(y.length)throw new Error("unsupported RRULE parm: ".concat(y.join(",")));t.push(Yn(l));break;case"RDATE":var S=(h=/RDATE(?:;TZID=([^:=]+))?/i.exec(l))!==null&&h!==void 0?h:[],R=S[1];R&&!c&&(c=R),s=s.concat(lr(x,y));break;case"EXRULE":if(y.length)throw new Error("unsupported EXRULE parm: ".concat(y.join(",")));o.push(Yn(x));break;case"EXDATE":r=r.concat(lr(x,y));break;case"DTSTART":break;default:throw new Error("unsupported property: "+m)}}}),{dtstart:a,tzid:c,rrulevals:t,rdatevals:s,exrulevals:o,exdatevals:r}}function Ul(n,e){var t=Fl(n,e),s=t.rrulevals,o=t.rdatevals,r=t.exrulevals,i=t.exdatevals,a=t.dtstart,c=t.tzid,u=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||s.length>1||o.length||r.length||i.length){var l=new Hl(u);return l.dtstart(a),l.tzid(c||void 0),s.forEach(function(d){l.rrule(new _(Tn(d,a,c),u))}),o.forEach(function(d){l.rdate(d)}),r.forEach(function(d){l.exrule(new _(Tn(d,a,c),u))}),i.forEach(function(d){l.exdate(d)}),e.compatible&&e.dtstart&&l.rdate(a),l}var h=s[0]||{};return new _(Tn(h,h.dtstart||e.dtstart||a,h.tzid||e.tzid||c),u)}function ur(n,e){return e===void 0&&(e={}),Ul(n,Pl(e))}function Tn(n,e,t){return $e($e({},n),{dtstart:e,tzid:t})}function Pl(n){var e=[],t=Object.keys(n),s=Object.keys(cr);if(t.forEach(function(o){Z(s,o)||e.push(o)}),e.length)throw new Error("Invalid options: "+e.join(", "));return $e($e({},cr),n)}function Bl(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=ju(n,":",1),t=e[0],s=e[1];return{name:t,value:s}}function Wl(n){var e=Bl(n),t=e.name,s=e.value,o=t.split(";");if(!o)throw new Error("empty property name");return{name:o[0].toUpperCase(),parms:o.slice(1),value:s}}function Gl(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),s=0;s<t.length;){var o=t[s]=t[s].replace(/\s+$/g,"");o?s>0&&o[0]===" "?(t[s-1]+=o.slice(1),t.splice(s,1)):s+=1:t.splice(s,1)}return t}function Yl(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function lr(n,e){return Yl(e),n.split(",").map(function(t){return To(t)})}function dr(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var s=0;s<e._rrule.length;s++){var o=e._rrule[s].origOptions[n];if(o)return o}}}var Hl=function(n){mo(e,n);function e(t){t===void 0&&(t=!1);var s=n.call(this,{},t)||this;return s.dtstart=dr.apply(s,["dtstart"]),s.tzid=dr.apply(s,["tzid"]),s._rrule=[],s._rdate=[],s._exrule=[],s._exdate=[],s}return e.prototype._iter=function(t){return zl(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){hr(t,this._rrule)},e.prototype.exrule=function(t){hr(t,this._exrule)},e.prototype.rdate=function(t){pr(t,this._rdate)},e.prototype.exdate=function(t){pr(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return ur(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return ur(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(Hn({dtstart:this._dtstart}))),this._rrule.forEach(function(s){t=t.concat(s.toString().split(`
`))}),this._exrule.forEach(function(s){t=t.concat(s.toString().split(`
`).map(function(o){return o.replace(/^RRULE:/,"EXRULE:")}).filter(function(o){return!/^DTSTART/.test(o)}))}),this._rdate.length&&t.push(fr("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(fr("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(s){return t.rrule(s.clone())}),this._exrule.forEach(function(s){return t.exrule(s.clone())}),this._rdate.forEach(function(s){return t.rdate(new Date(s.getTime()))}),this._exdate.forEach(function(s){return t.exdate(new Date(s.getTime()))}),t},e}(_);function hr(n,e){if(!(n instanceof _))throw new TypeError(String(n)+" is not RRule instance");Z(e.map(String),String(n))||e.push(n)}function pr(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");Z(e.map(Number),Number(n))||(e.push(n),gs(e))}function fr(n,e,t){var s=!t||t.toUpperCase()==="UTC",o=s?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),r=e.map(function(i){return vo(i.valueOf(),s)}).join(",");return"".concat(o).concat(r)}const mr={VERTEX:"vertex",FRAGMENT:"fragment"},W={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},sn=["x","y","z","w"];function Ti(n,e=!1){let t="{";n.isNode===!0&&(t+=n.id);for(const{property:s,childNode:o}of Ys(n))t+=","+s.slice(0,-4)+":"+o.getCacheKey(e);return t+="}",t}function*Ys(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const s=n[t];if(Array.isArray(s)===!0)for(let o=0;o<s.length;o++){const r=s[o];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:o,childNode:r})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const o in s){const r=s[o];r&&(r.isNode===!0||e&&typeof r.toJSON=="function")&&(yield{property:t,index:o,childNode:r})}}}function yt(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function xi(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new go(...e):t==="vec2"?new Ne(...e):t==="vec3"?new Se(...e):t==="vec4"?new Nt(...e):t==="mat3"?new Pc(...e):t==="mat4"?new ws(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?bi(e[0]):null}function wi(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function bi(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const gr=new Map;let $l=0;class D extends ei{constructor(e=null){super(),this.nodeType=e,this.updateType=W.NONE,this.updateBeforeType=W.NONE,this.updateAfterType=W.NONE,this.uuid=ti.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:$l++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,W.FRAME)}onRenderUpdate(e){return this.onUpdate(e,W.RENDER)}onObjectUpdate(e){return this.onUpdate(e,W.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of Ys(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=Ti(this,e),this._cacheKeyVersion=this.version),this._cacheKey}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let s=0;for(const o of this.getChildren())t["node"+s++]=o;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}increaseUsage(e){const t=e.getDataFromNode(this);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}analyze(e){if(this.increaseUsage(e)===1){const s=e.getNodeProperties(this);for(const o of Object.values(s))o&&o.isNode===!0&&o.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let o=null;const r=e.getBuildStage();if(r==="setup"){this.updateReference(e);const i=e.getNodeProperties(this);if(i.initialized!==!0){const a=e.stack.nodes.length;i.initialized=!0,i.outputNode=this.setup(e),i.outputNode!==null&&e.stack.nodes.length!==a&&(i.outputNode=e.stack);for(const c of Object.values(i))c&&c.isNode===!0&&c.build(e)}}else if(r==="analyze")this.analyze(e);else if(r==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);o=c.snippet,o===void 0&&(o=this.generate(e)||"",c.snippet=o),o=e.format(o,a,t)}else o=this.generate(e,t)||"";return e.removeChain(this),o}getSerializeChildren(){return Ys(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:o,index:r,childNode:i}of t)r!==void 0?(s[o]===void 0&&(s[o]=Number.isInteger(r)?[]:{}),s[o][r]=i.toJSON(e.meta).uuid):s[o]=i.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const o=[];for(const r of e.inputNodes[s])o.push(t[r]);this[s]=o}else if(typeof e.inputNodes[s]=="object"){const o={};for(const r in e.inputNodes[s]){const i=e.inputNodes[s][r];o[r]=t[i]}this[s]=o}else{const o=e.inputNodes[s];this[s]=t[o]}}}toJSON(e){const{uuid:t,type:s}=this,o=e===void 0||typeof e=="string";o&&(e={textures:{},images:{},nodes:{}});let r=e.nodes[t];r===void 0&&(r={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},o!==!0&&(e.nodes[r.uuid]=r),this.serialize(r),delete r.meta);function i(a){const c=[];for(const u in a){const l=a[u];delete l.metadata,c.push(l)}return c}if(o){const a=i(e.textures),c=i(e.images),u=i(e.nodes);a.length>0&&(r.textures=a),c.length>0&&(r.images=c),u.length>0&&(r.nodes=u)}return r}}function w(n,e){if(typeof e!="function"||!n)throw new Error(`Node class ${n} is not a class`);if(gr.has(n)){console.warn(`Redefinition of node class ${n}`);return}gr.set(n,e),e.type=n}class H extends D{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const o=e.getVectorType(this.getNodeType(e,t)),r=e.getDataFromNode(this);if(r.propertyName!==void 0)return e.format(r.propertyName,o,t);if(o!=="void"&&t!=="void"&&this.hasDependencies(e)){const i=super.build(e,o),a=e.getVarFromNode(this,null,o),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${i}`),r.snippet=i,r.propertyName=c,e.format(r.propertyName,o,t)}}return super.build(e,t)}}w("TempNode",H);class Qt extends D{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}w("ArrayElementNode",Qt);class bo extends D{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const o of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(o))&&(s=o);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,o=this.getNodeType(e),r=s.build(e,o);return e.format(r,o,t)}}w("ConvertNode",bo);class Si extends H{constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),o=this.nodes,r=e.getComponentType(s),i=[];for(const c of o){let u=c.build(e);const l=e.getComponentType(c.getNodeType(e));l!==r&&(u=e.format(u,l,r)),i.push(u)}const a=`${e.getType(s)}( ${i.join(", ")} )`;return e.format(a,s,t)}}w("JoinNode",Si);const ql=sn.join("");class $n extends D{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(sn.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const s=this.node,o=e.getTypeLength(s.getNodeType(e));let r=null;if(o>1){let i=null;this.getVectorLength()>=o&&(i=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=s.build(e,i);this.components.length===o&&this.components===ql.slice(0,this.components.length)?r=e.format(c,i,t):r=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else r=s.build(e,t);return r}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}w("SplitNode",$n);class Mi extends H{constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:o}=this,r=this.getNodeType(e),i=e.getTypeFromLength(s.length),a=o.build(e,i),c=t.build(e,r),u=e.getTypeLength(r),l=[];for(let h=0;h<u;h++){const d=sn[h];d===s[0]?(l.push(a),h+=s.length-1):l.push(c+"."+d)}return`${e.getType(r)}( ${l.join(", ")} )`}}w("SetNode",Mi);class nn extends D{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?yt(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=yt(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=wi(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?xi(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}w("InputNode",nn);class rt extends nn{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}w("ConstNode",rt);let Xt=null;const zt=new Map;function f(n,e){if(zt.has(n)){console.warn(`Redefinition of node element ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);zt.set(n,e)}const yr=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),Ei={setup(n,e){const t=e.shift();return n(an(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...s)=>(Xt.assign(t,...s),t);if(zt.has(e)){const s=zt.get(e);return n.isStackNode?(...o)=>t.add(s(...o)):(...o)=>s(t,...o)}else{if(e==="self")return n;if(e.endsWith("Assign")&&zt.has(e.slice(0,e.length-6))){const s=zt.get(e.slice(0,e.length-6));return n.isStackNode?(...o)=>t.assign(o[0],s(...o)):(...o)=>t.assign(s(t,...o))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=yr(e),M(new $n(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=yr(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>M(new Mi(n,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),M(new $n(n,e));if(/^\d+$/.test(e)===!0)return M(new Qt(t,new rt(Number(e),"uint")))}}}return Reflect.get(n,e,t)},set(n,e,t,s){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(n,e,t,s)}},xn=new WeakMap,Nr=new WeakMap,jl=function(n,e=null){const t=yt(n);if(t==="node"){let s=xn.get(n);return s===void 0&&(s=new Proxy(n,Ei),xn.set(n,s),xn.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return M(qn(n,e));if(t==="shader")return E(n)}return n},Kl=function(n,e=null){for(const t in n)n[t]=M(n[t],e);return n},Xl=function(n,e=null){const t=n.length;for(let s=0;s<t;s++)n[s]=M(n[s],e);return n},Zl=function(n,e=null,t=null,s=null){const o=r=>M(s!==null?Object.assign(r,s):r);return e===null?(...r)=>o(new n(...Gt(r))):t!==null?(t=M(t),(...r)=>o(new n(e,...Gt(r),t))):(...r)=>o(new n(e,...Gt(r)))},Jl=function(n,...e){return M(new n(...Gt(e)))};class Ql extends D{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let i=Nr.get(e.constructor);i===void 0&&(i=new WeakMap,Nr.set(e.constructor,i));let a=i.get(t);return a===void 0&&(a=M(e.buildFunctionNode(t)),i.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),M(a.call(s))}const o=t.jsFunc,r=s!==null?o(s,e.stack,e):o(e.stack,e);return M(r)}setup(e){const{outputNode:t}=e.getNodeProperties(this);return t||this.setupOutput(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class ed extends D{constructor(e){super(),this.jsFunc=e,this.layout=null,this.global=!0}get isArrayInput(){return/^\((\s+)?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return an(e),M(new Ql(this,e))}setup(){return this.call()}}const td=[!1,!0],sd=[0,1,2,3],nd=[-1,-2],Ai=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],So=new Map;for(const n of td)So.set(n,new rt(n));const Mo=new Map;for(const n of sd)Mo.set(n,new rt(n,"uint"));const Eo=new Map([...Mo].map(n=>new rt(n.value,"int")));for(const n of nd)Eo.set(n,new rt(n,"int"));const on=new Map([...Eo].map(n=>new rt(n.value)));for(const n of Ai)on.set(n,new rt(n));for(const n of Ai)on.set(-n,new rt(-n));const rn={bool:So,uint:Mo,ints:Eo,float:on},vr=new Map([...So,...on]),qn=(n,e)=>vr.has(n)?vr.get(n):n.isNode===!0?n:new rt(n,e),od=n=>{try{return n.getNodeType()}catch{return}},K=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(o=>typeof o!="object"))&&(t=[xi(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return M(e.get(t[0]));if(t.length===1){const o=qn(t[0],n);return od(o)===n?M(o):M(new bo(o,n))}const s=t.map(o=>qn(o));return M(new Si(s,n))}},Tr=n=>n&&n.value,rd=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function hs(n){return new Proxy(new ed(n),Ei)}const M=(n,e=null)=>jl(n,e),an=(n,e=null)=>new Kl(n,e),Gt=(n,e=null)=>new Xl(n,e),g=(...n)=>new Zl(...n),A=(...n)=>new Jl(...n),E=n=>{const e=new hs(n),t=(...s)=>{let o;return an(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],e.call(o)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};w("ShaderNode",hs);f("toGlobal",n=>(n.global=!0,n));const xr=n=>{Xt=n},id=()=>Xt,se=(...n)=>Xt.if(...n);function ad(n){return Xt&&Xt.add(n),n}f("append",ad);const cd=new K("color"),T=new K("float",rn.float),ie=new K("int",rn.ints),ud=new K("uint",rn.uint),ld=new K("bool",rn.bool),b=new K("vec2"),ft=new K("ivec2"),dd=new K("uvec2"),hd=new K("bvec2"),N=new K("vec3"),pd=new K("ivec3"),fd=new K("uvec3"),md=new K("bvec3"),L=new K("vec4"),gd=new K("ivec4"),yd=new K("uvec4"),Nd=new K("bvec4"),Ao=new K("mat2"),vd=new K("imat2"),Td=new K("umat2"),xd=new K("bmat2"),ve=new K("mat3"),wd=new K("imat3"),bd=new K("umat3"),Sd=new K("bmat3"),Yt=new K("mat4"),Md=new K("imat4"),Ed=new K("umat4"),Ad=new K("bmat4");f("toColor",cd);f("toFloat",T);f("toInt",ie);f("toUint",ud);f("toBool",ld);f("toVec2",b);f("toIvec2",ft);f("toUvec2",dd);f("toBvec2",hd);f("toVec3",N);f("toIvec3",pd);f("toUvec3",fd);f("toBvec3",md);f("toVec4",L);f("toIvec4",gd);f("toUvec4",yd);f("toBvec4",Nd);f("toMat2",Ao);f("toImat2",vd);f("toUmat2",Td);f("toBmat2",xd);f("toMat3",ve);f("toImat3",wd);f("toUmat3",bd);f("toBmat3",Sd);f("toMat4",Yt);f("toImat4",Md);f("toUmat4",Ed);f("toBmat4",Ad);const Rd=g(Qt),Cd=(n,e)=>M(new bo(M(n),e));f("element",Rd);f("convert",Cd);class Ri extends H{constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const s=e.getTypeLength(t.node.getNodeType(e));return sn.join("").slice(0,s)!==t.components}return!1}generate(e,t){const{targetNode:s,sourceNode:o}=this,r=this.needsSplitAssign(e),i=s.getNodeType(e),a=s.context({assign:!0}).build(e),c=o.build(e,i),u=o.getNodeType(e),l=e.getDataFromNode(this);let h;if(l.initialized===!0)t!=="void"&&(h=a);else if(r){const d=e.getVarFromNode(this,null,i),m=e.getPropertyName(d);e.addLineFlowCode(`${m} = ${c}`);const y=s.node.context({assign:!0}).build(e);for(let x=0;x<s.components.length;x++){const S=s.components[x];e.addLineFlowCode(`${y}.${S} = ${m}[ ${x} ]`)}t!=="void"&&(h=a)}else h=`${a} = ${c}`,(t==="void"||u==="void")&&(e.addLineFlowCode(h),t!=="void"&&(h=a));return l.initialized=!0,e.format(h,i,t)}}const Ld=g(Ri);w("AssignNode",Ri);f("assign",Ld);class Ci extends D{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let s=t.varying;if(s===void 0){const o=this.name,r=this.getNodeType(e);t.varying=s=e.getVaryingFromNode(this,o,r),t.node=this.node}return s.needsInterpolation||(s.needsInterpolation=e.shaderStage==="fragment"),s}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),s=this.setupVarying(e);if(t.propertyName===void 0){const o=this.getNodeType(e),r=e.getPropertyName(s,mr.VERTEX);e.flowNodeFromShaderStage(mr.VERTEX,this.node,o,r),t.propertyName=r}return e.getPropertyName(s)}}const oe=g(Ci);f("varying",oe);w("VaryingNode",Ci);class Ro extends D{constructor(e,t=null,s=null){super(t),this.defaultNode=s,this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const o=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(o)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const r=e.geometry.getAttribute(t),i=e.getTypeFromAttribute(r),a=e.getAttribute(t,i);return e.shaderStage==="vertex"?e.format(a.name,i,s):oe(this).build(e,s)}else{console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`);const{defaultNode:r}=this;return r!==null?r.build(e,s):e.generateConst(s)}}}const ge=(n,e,t)=>M(new Ro(n,e,M(t)));w("AttributeNode",Ro);class Li extends D{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const Ii=g(Li);f("bypass",Ii);w("BypassNode",Li);class Oi extends D{constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),o=e.getCacheFromNode(this,parent);e.setCache(o);const r=this.node.build(e,...t);return e.setCache(s),r}}const ks=(n,...e)=>M(new Oi(M(n),...e));f("cache",ks);w("CacheNode",Oi);class Co extends D{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const o=this.node.build(e,t);return e.setContext(s),o}}const ps=g(Co),Id=(n,e)=>ps(n,{label:e});f("context",ps);f("label",Id);w("ContextNode",Co);class Ee extends D{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let o;if(s===Ee.VERTEX)o=e.getVertexIndex();else if(s===Ee.INSTANCE)o=e.getInstanceIndex();else if(s===Ee.DRAW)o=e.getDrawIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let r;return e.shaderStage==="vertex"||e.shaderStage==="compute"?r=o:r=oe(this).build(e,t),r}}Ee.VERTEX="vertex";Ee.INSTANCE="instance";Ee.DRAW="draw";const Od=A(Ee,Ee.VERTEX),Lo=A(Ee,Ee.INSTANCE),Dd=A(Ee,Ee.DRAW);w("IndexNode",Ee);class cn{start(){}finish(){}direct(){}directRectArea(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class Di extends D{constructor(e,t=null){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,o=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),r=e.getPropertyName(o),i=t.build(e,o.type);return e.addLineFlowCode(`${r} = ${i}`),r}}const Hs=g(Di);f("temp",Hs);f("toVar",(...n)=>Hs(...n).append());w("VarNode",Di);class $ extends D{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const ee=(n,e)=>M(new $(n,e)),Ke=(n,e)=>M(new $(n,e,!0)),X=A($,"vec4","DiffuseColor"),ct=A($,"float","Roughness"),$s=A($,"float","Metalness"),jn=A($,"float","Clearcoat"),qs=A($,"float","ClearcoatRoughness"),Ft=A($,"vec3","Sheen"),Io=A($,"float","SheenRoughness"),Oo=A($,"float","Iridescence"),_i=A($,"float","IridescenceIOR"),ki=A($,"float","IridescenceThickness"),Kn=A($,"float","AlphaT"),Mt=A($,"float","Anisotropy"),Vs=A($,"vec3","AnisotropyT"),Ht=A($,"vec3","AnisotropyB"),De=A($,"color","SpecularColor"),js=A($,"float","SpecularF90"),Xn=A($,"float","Shininess"),_d=A($,"vec4","Output"),$t=A($,"float","dashSize"),Ks=A($,"float","gapSize");A($,"float","pointWidth");const zs=A($,"float","IOR"),Zn=A($,"float","Transmission"),Vi=A($,"float","Thickness"),zi=A($,"float","AttenuationDistance"),Fi=A($,"color","AttenuationColor"),Ui=A($,"float","Dispersion");w("PropertyNode",$);class kd extends ${constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}w("ParameterNode",kd);class Do extends D{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const o of t)o.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}g(Do);w("CodeNode",Do);class Vd extends Do{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),o=s.name,r=s.type,i=e.getCodeFromNode(this,r);o!==""&&(i.name=o);const a=e.getPropertyName(i);let c=this.getNodeFunction(e).getCode(a);const u=this.keywords,l=Object.keys(u);if(l.length>0)for(const h of l){const d=new RegExp(`\\b${h}\\b`,"g"),m=u[h].build(e,"property");c=c.replace(d,m)}return i.code=c+`
`,t==="property"?a:e.format(`${a}()`,r,t)}}w("FunctionNode",Vd);class _o extends D{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const zd=n=>new _o(n),ko=n=>new _o(n,!0);ko("frame");ko("render");const Fd=zd("object");w("UniformGroupNode",_o);class Lt extends nn{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=Fd}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const s=this.getSelf();return e=e.bind(s),super.onUpdate(o=>{const r=e(o,s);r!==void 0&&(this.value=r)},t)}generate(e,t){const s=this.getNodeType(e),o=this.getUniformHash(e);let r=e.getNodeFromHash(o);r===void 0&&(e.setHashNode(this,o),r=this);const i=r.getInputType(e),a=e.getUniformFromNode(r,i,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const k=(n,e)=>{const t=rd(e||n),s=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return M(new Lt(s,t))};w("UniformNode",Lt);const Le=n=>ge("uv"+(n>0?n:""),"vec2");class Pi extends D{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),o=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${o} )`,this.getNodeType(e),t)}}const Xs=g(Pi);f("textureSize",Xs);w("TextureSizeNode",Pi);class J extends H{constructor(e,t,s,...o){if(super(),o.length>0){let r=new J(e,t,s);for(let i=0;i<o.length-1;i++)r=new J(e,r,o[i]);t=r,s=o[o.length-1]}this.op=e,this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,o=this.aNode,r=this.bNode,i=o.getNodeType(e),a=typeof r<"u"?r.getNodeType(e):null;if(i==="void"||a==="void")return"void";if(s==="%")return i;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(i);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(i),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return i==="float"&&e.isMatrix(a)?a:e.isMatrix(i)&&e.isVector(a)?e.getVectorFromMatrix(i):e.isVector(i)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(i)?a:i}generate(e,t){const s=this.op,o=this.aNode,r=this.bNode,i=this.getNodeType(e,t);let a=null,c=null;i!=="void"?(a=o.getNodeType(e),c=typeof r<"u"?r.getNodeType(e):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=i,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=i):a=c=i;const u=o.build(e,a),l=typeof r<"u"?r.build(e,c):null,h=e.getTypeLength(t),d=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&h>1?e.format(`${e.getMethod("lessThan")}( ${u}, ${l} )`,i,t):s==="<="&&h>1?e.format(`${e.getMethod("lessThanEqual")}( ${u}, ${l} )`,i,t):s===">"&&h>1?e.format(`${e.getMethod("greaterThan")}( ${u}, ${l} )`,i,t):s===">="&&h>1?e.format(`${e.getMethod("greaterThanEqual")}( ${u}, ${l} )`,i,t):s==="!"||s==="~"?e.format(`(${s}${u})`,a,t):d?e.format(`${d}( ${u}, ${l} )`,i,t):e.format(`( ${u} ${s} ${l} )`,i,t);if(a!=="void")return d?e.format(`${d}( ${u}, ${l} )`,i,t):e.format(`${u} ${s} ${l}`,i,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Re=g(J,"+"),tt=g(J,"-"),q=g(J,"*"),ht=g(J,"/"),Ud=g(J,"%"),Pd=g(J,"=="),Bd=g(J,"!="),Wd=g(J,"<"),Gd=g(J,">"),Yd=g(J,"<="),Hd=g(J,">="),$d=g(J,"&&"),qd=g(J,"||"),jd=g(J,"!"),Kd=g(J,"^^"),Xd=g(J,"&"),Zd=g(J,"~"),Jd=g(J,"|"),Qd=g(J,"^"),eh=g(J,"<<"),th=g(J,">>");f("add",Re);f("sub",tt);f("mul",q);f("div",ht);f("remainder",Ud);f("equal",Pd);f("notEqual",Bd);f("lessThan",Wd);f("greaterThan",Gd);f("lessThanEqual",Yd);f("greaterThanEqual",Hd);f("and",$d);f("or",qd);f("not",jd);f("xor",Kd);f("bitAnd",Xd);f("bitNot",Zd);f("bitOr",Jd);f("bitXor",Qd);f("shiftLeft",eh);f("shiftRight",th);w("OperatorNode",J);class p extends H{constructor(e,t,s=null,o=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=o}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,o=this.cNode?this.cNode.getNodeType(e):null,r=e.isMatrix(t)?0:e.getTypeLength(t),i=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(o)?0:e.getTypeLength(o);return r>i&&r>a?t:i>a?s:a>r?o:t}getNodeType(e){const t=this.method;return t===p.LENGTH||t===p.DISTANCE||t===p.DOT?"float":t===p.CROSS?"vec3":t===p.ALL?"bool":t===p.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):t===p.MOD?this.aNode.getNodeType(e):this.getInputType(e)}generate(e,t){const s=this.method,o=this.getNodeType(e),r=this.getInputType(e),i=this.aNode,a=this.bNode,c=this.cNode,u=e.renderer.isWebGLRenderer===!0;if(s===p.TRANSFORM_DIRECTION){let l=i,h=a;e.isMatrix(l.getNodeType(e))?h=L(N(h),0):l=L(N(l),0);const d=q(l,h).xyz;return ys(d).build(e,t)}else{if(s===p.NEGATE)return e.format("( - "+i.build(e,r)+" )",o,t);if(s===p.ONE_MINUS)return tt(1,i).build(e,t);if(s===p.RECIPROCAL)return ht(1,i).build(e,t);if(s===p.DIFFERENCE)return Je(tt(i,a)).build(e,t);{const l=[];return s===p.CROSS||s===p.MOD?l.push(i.build(e,o),a.build(e,o)):s===p.STEP?l.push(i.build(e,e.getTypeLength(i.getNodeType(e))===1?"float":r),a.build(e,r)):u&&(s===p.MIN||s===p.MAX)||s===p.MOD?l.push(i.build(e,r),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":r)):s===p.REFRACT?l.push(i.build(e,r),a.build(e,r),c.build(e,"float")):s===p.MIX?l.push(i.build(e,r),a.build(e,r),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":r)):(l.push(i.build(e,r)),a!==null&&l.push(a.build(e,r)),c!==null&&l.push(c.build(e,r))),e.format(`${e.getMethod(s,o)}( ${l.join(", ")} )`,o,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}p.ALL="all";p.ANY="any";p.EQUALS="equals";p.RADIANS="radians";p.DEGREES="degrees";p.EXP="exp";p.EXP2="exp2";p.LOG="log";p.LOG2="log2";p.SQRT="sqrt";p.INVERSE_SQRT="inversesqrt";p.FLOOR="floor";p.CEIL="ceil";p.NORMALIZE="normalize";p.FRACT="fract";p.SIN="sin";p.COS="cos";p.TAN="tan";p.ASIN="asin";p.ACOS="acos";p.ATAN="atan";p.ABS="abs";p.SIGN="sign";p.LENGTH="length";p.NEGATE="negate";p.ONE_MINUS="oneMinus";p.DFDX="dFdx";p.DFDY="dFdy";p.ROUND="round";p.RECIPROCAL="reciprocal";p.TRUNC="trunc";p.FWIDTH="fwidth";p.BITCAST="bitcast";p.TRANSPOSE="transpose";p.ATAN2="atan2";p.MIN="min";p.MAX="max";p.MOD="mod";p.STEP="step";p.REFLECT="reflect";p.DISTANCE="distance";p.DIFFERENCE="difference";p.DOT="dot";p.CROSS="cross";p.POW="pow";p.TRANSFORM_DIRECTION="transformDirection";p.MIX="mix";p.CLAMP="clamp";p.REFRACT="refract";p.SMOOTHSTEP="smoothstep";p.FACEFORWARD="faceforward";const Bi=T(1e-6);T(1e6);const wr=T(Math.PI);T(Math.PI*2);const Wi=g(p,p.ALL),sh=g(p,p.ANY),nh=g(p,p.EQUALS),oh=g(p,p.RADIANS),rh=g(p,p.DEGREES),Gi=g(p,p.EXP),Jn=g(p,p.EXP2),Yi=g(p,p.LOG),un=g(p,p.LOG2),ih=g(p,p.SQRT),ah=g(p,p.INVERSE_SQRT),ln=g(p,p.FLOOR),Hi=g(p,p.CEIL),ys=g(p,p.NORMALIZE),dn=g(p,p.FRACT),_e=g(p,p.SIN),Ze=g(p,p.COS),ch=g(p,p.TAN),uh=g(p,p.ASIN),lh=g(p,p.ACOS),dh=g(p,p.ATAN),Je=g(p,p.ABS),Vo=g(p,p.SIGN),qt=g(p,p.LENGTH),hh=g(p,p.NEGATE),ph=g(p,p.ONE_MINUS),fh=g(p,p.DFDX),mh=g(p,p.DFDY),gh=g(p,p.ROUND),yh=g(p,p.RECIPROCAL),Nh=g(p,p.TRUNC),vh=g(p,p.FWIDTH);g(p,p.BITCAST);const Th=g(p,p.TRANSPOSE),xh=g(p,p.ATAN2),ut=g(p,p.MIN),be=g(p,p.MAX),wh=g(p,p.MOD),bh=g(p,p.STEP),Sh=g(p,p.REFLECT),Mh=g(p,p.DISTANCE),Eh=g(p,p.DIFFERENCE),hn=g(p,p.DOT),$i=g(p,p.CROSS),lt=g(p,p.POW),qi=g(p,p.POW,2),Ah=g(p,p.POW,3),Rh=g(p,p.POW,4),Ch=g(p,p.TRANSFORM_DIRECTION),Lh=n=>q(Vo(n),lt(Je(n),1/3)),Ih=n=>hn(n,n),re=g(p,p.MIX),At=(n,e=0,t=1)=>M(new p(p.CLAMP,M(n),M(e),M(t))),Oh=n=>At(n),ji=g(p,p.REFRACT),st=g(p,p.SMOOTHSTEP),Dh=g(p,p.FACEFORWARD),_h=(n,e,t)=>re(e,t,n),kh=(n,e,t)=>st(e,t,n);f("all",Wi);f("any",sh);f("equals",nh);f("radians",oh);f("degrees",rh);f("exp",Gi);f("exp2",Jn);f("log",Yi);f("log2",un);f("sqrt",ih);f("inverseSqrt",ah);f("floor",ln);f("ceil",Hi);f("normalize",ys);f("fract",dn);f("sin",_e);f("cos",Ze);f("tan",ch);f("asin",uh);f("acos",lh);f("atan",dh);f("abs",Je);f("sign",Vo);f("length",qt);f("lengthSq",Ih);f("negate",hh);f("oneMinus",ph);f("dFdx",fh);f("dFdy",mh);f("round",gh);f("reciprocal",yh);f("trunc",Nh);f("fwidth",vh);f("atan2",xh);f("min",ut);f("max",be);f("mod",wh);f("step",bh);f("reflect",Sh);f("distance",Mh);f("dot",hn);f("cross",$i);f("pow",lt);f("pow2",qi);f("pow3",Ah);f("pow4",Rh);f("transformDirection",Ch);f("mix",_h);f("clamp",At);f("refract",ji);f("smoothstep",kh);f("faceForward",Dh);f("difference",Eh);f("saturate",Oh);f("cbrt",Lh);f("transpose",Th);w("MathNode",p);const Vh=E(n=>{const{value:e}=n,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),o=t.mul(.0773993808),r=t.lessThanEqual(.04045),i=re(s,o,r);return L(i,e.a)}),zh=E(n=>{const{value:e}=n,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),o=t.mul(12.92),r=t.lessThanEqual(.0031308),i=re(s,o,r);return L(i,e.a)}),br=n=>{let e=null;return n===yo?e="Linear":n===Bc&&(e="sRGB"),e},Ki=(n,e)=>br(n)+"To"+br(e);class Ce extends H{constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===Ce.LINEAR_TO_LINEAR?t:Fh[e]({value:t})}}Ce.LINEAR_TO_LINEAR="LinearToLinear";Ce.LINEAR_TO_sRGB="LinearTosRGB";Ce.sRGB_TO_LINEAR="sRGBToLinear";const Fh={[Ce.LINEAR_TO_sRGB]:zh,[Ce.sRGB_TO_LINEAR]:Vh},Uh=(n,e)=>M(new Ce(Ki(yo,e),M(n))),Xi=(n,e)=>M(new Ce(Ki(e,yo),M(n))),Ph=g(Ce,Ce.LINEAR_TO_sRGB),Bh=g(Ce,Ce.sRGB_TO_LINEAR);f("linearTosRGB",Ph);f("sRGBToLinear",Bh);f("linearToColorSpace",Uh);f("colorSpaceToLinear",Xi);w("ColorSpaceNode",Ce);class Zi extends D{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),o=this.snippet;if(s==="void")e.addLineFlowCode(o);else return e.format(`( ${o} )`,s,t)}}const pn=g(Zi);w("ExpressionNode",Zi);class Ji extends Lt{constructor(e){super(0),this.textureNode=e,this.updateType=W.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:o,height:r}=s;this.value=Math.log2(Math.max(o,r))}}}const Wh=g(Ji);w("MaxMipLevelNode",Ji);class It extends Lt{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=W.NONE,this.referenceNode=null,this._value=e,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Wc?"uvec4":this.value.type===Gc?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Le(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return k(t.matrix).mul(N(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?W.FRAME:W.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let o=this.levelNode;o===null&&e.context.getTextureLevel&&(o=e.context.getTextureLevel(this)),t.uvNode=s,t.levelNode=o,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,o,r,i,a){const c=this.value;let u;return o?u=e.generateTextureLevel(c,t,s,o,r):a?u=e.generateTextureGrad(c,t,s,a,r):i?u=e.generateTextureCompare(c,t,s,i,r):this.sampler===!1?u=e.generateTextureLoad(c,t,s,r):u=e.generateTexture(c,t,s,r),u}generate(e,t){const s=e.getNodeProperties(this),o=this.value;if(!o||o.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const r=super.generate(e,"property");if(t==="sampler")return r+"_sampler";if(e.isReference(t))return r;{const i=e.getDataFromNode(this);let a=i.propertyName;if(a===void 0){const{uvNode:l,levelNode:h,compareNode:d,depthNode:m,gradNode:y}=s,x=this.generateUV(e,l),S=h?h.build(e,"float"):null,R=m?m.build(e,"int"):null,O=d?d.build(e,"float"):null,I=y?[y[0].build(e,"vec2"),y[1].build(e,"vec2")]:null,j=e.getVarFromNode(this);a=e.getPropertyName(j);const U=this.generateSnippet(e,r,x,S,R,O,I);e.addLineFlowCode(`${a} = ${U}`),i.snippet=U,i.propertyName=a}let c=a;const u=this.getNodeType(e);return e.needsColorSpaceToLinear(o)&&(c=Xi(pn(c,u),o.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,t.referenceNode=this,M(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(Wh(t)),t.referenceNode=this,M(t)}level(e){const t=this.clone();return t.levelNode=e,t.referenceNode=this,t}size(e){return Xs(this,e)}compare(e){const t=this.clone();return t.compareNode=M(e),t.referenceNode=this,M(t)}grad(e,t){const s=this.clone();return s.gradNode=[M(e),M(t)],s.referenceNode=this,M(s)}depth(e){const t=this.clone();return t.depthNode=M(e),t.referenceNode=this,M(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const de=g(It),at=(...n)=>de(...n).setSampler(!1);f("texture",de);w("TextureNode",It);class fn extends Lt{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const zo=(n,e,t)=>M(new fn(n,e,t));w("BufferNode",fn);class Gh extends Qt{constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=super.generate(e),s=this.getNodeType();return e.format(t,"vec4",s)}}class Qi extends fn{constructor(e,t=null){super(null,"vec4"),this.array=e,this.elementType=t,this._elementType=null,this._elementLength=0,this.updateType=W.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:e,value:t}=this,s=this.getElementLength(),o=this.getElementType();if(s===1)for(let r=0;r<e.length;r++){const i=r*4;t[i]=e[r]}else if(o==="color")for(let r=0;r<e.length;r++){const i=r*4,a=e[r];t[i]=a.r,t[i+1]=a.g,t[i+2]=a.b||0}else for(let r=0;r<e.length;r++){const i=r*4,a=e[r];t[i]=a.x,t[i+1]=a.y,t[i+2]=a.z||0,t[i+3]=a.w||0}}setup(e){const t=this.array.length;this._elementType=this.elementType===null?yt(this.array[0]):this.elementType,this._elementLength=e.getTypeLength(this._elementType);let s=Float32Array;return this._elementType.charAt(0)==="i"?s=Int32Array:this._elementType.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(t*4),this.bufferCount=t,this.bufferType=e.changeComponentType("vec4",e.getComponentType(this._elementType)),super.setup(e)}element(e){return M(new Gh(this,M(e)))}}const Qn=(n,e)=>M(new Qi(n,e));w("UniformsNode",Qi);class Yh extends Qt{constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),s=this.referenceNode.getNodeType(),o=this.getNodeType();return e.format(t,s,o)}}class es extends D{constructor(e,t,s=null,o=null){super(),this.property=e,this.uniformType=t,this.object=s,this.count=o,this.properties=e.split("."),this.reference=null,this.node=null,this.updateType=W.OBJECT}element(e){return M(new Yh(this,M(e)))}setNodeType(e){let t=null;this.count!==null?t=zo(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Qn(null,e):e==="texture"?t=de(null):t=k(null,e),this.node=t}getNodeType(e){return this.node===null&&this.updateValue(),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let s=e[t[0]];for(let o=1;o<t.length;o++)s=s[t[o]];return s}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const Ue=(n,e,t)=>M(new es(n,e,t)),Hh=(n,e,t,s)=>M(new es(n,e,s,t));w("ReferenceNode",es);class ea extends es{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const dt=(n,e,t)=>M(new ea(n,e,t));w("MaterialReferenceNode",ea);const Ot=ko("camera").onRenderUpdate(()=>{Ot.needsUpdate=!0}),ns=k("float").label("cameraNear").setGroup(Ot).onRenderUpdate(({camera:n})=>n.near),os=k("float").label("cameraFar").setGroup(Ot).onRenderUpdate(({camera:n})=>n.far),$h=k("float").label("cameraLogDepth").setGroup(Ot).onRenderUpdate(({camera:n})=>2/(Math.log(n.far+1)/Math.LN2)),Qe=k("mat4").label("cameraProjectionMatrix").setGroup(Ot).onRenderUpdate(({camera:n})=>n.projectionMatrix),ts=k("mat4").label("cameraViewMatrix").setGroup(Ot).onRenderUpdate(({camera:n})=>n.matrixWorldInverse),ta=k(new Se).label("cameraPosition").setGroup(Ot).onRenderUpdate(({camera:n},e)=>e.value.setFromMatrixPosition(n.matrixWorld));class V extends D{constructor(e=V.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=W.OBJECT,this._uniformNode=new Lt(null)}getNodeType(){const e=this.scope;if(e===V.WORLD_MATRIX||e===V.VIEW_MATRIX)return"mat4";if(e===V.NORMAL_MATRIX)return"mat3";if(e===V.POSITION||e===V.VIEW_POSITION||e===V.DIRECTION||e===V.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,o=this.scope;if(o===V.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(o===V.NORMAL_MATRIX)s.value=t.normalMatrix;else if(o===V.WORLD_MATRIX)s.value=t.matrixWorld;else if(o===V.POSITION)s.value=s.value||new Se,s.value.setFromMatrixPosition(t.matrixWorld);else if(o===V.SCALE)s.value=s.value||new Se,s.value.setFromMatrixScale(t.matrixWorld);else if(o===V.DIRECTION)s.value=s.value||new Se,t.getWorldDirection(s.value);else if(o===V.VIEW_POSITION){const r=e.camera;s.value=s.value||new Se,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(r.matrixWorldInverse)}}generate(e){const t=this.scope;return t===V.WORLD_MATRIX||t===V.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===V.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===V.POSITION||t===V.VIEW_POSITION||t===V.DIRECTION||t===V.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}V.VIEW_MATRIX="viewMatrix";V.NORMAL_MATRIX="normalMatrix";V.WORLD_MATRIX="worldMatrix";V.POSITION="position";V.SCALE="scale";V.VIEW_POSITION="viewPosition";V.DIRECTION="direction";g(V,V.DIRECTION);g(V,V.VIEW_MATRIX);g(V,V.NORMAL_MATRIX);g(V,V.WORLD_MATRIX);const eo=g(V,V.POSITION);g(V,V.SCALE);const Fo=g(V,V.VIEW_POSITION);w("Object3DNode",V);class pe extends V{constructor(e=pe.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}A(pe,pe.DIRECTION);const Rt=A(pe,pe.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),sa=A(pe,pe.NORMAL_MATRIX),Ns=A(pe,pe.WORLD_MATRIX);A(pe,pe.POSITION);A(pe,pe.SCALE);A(pe,pe.VIEW_POSITION);const qh=k(new ws).onObjectUpdate(({object:n},e)=>e.value.copy(n.matrixWorld).invert());w("ModelNode",pe);const Zs=ge("normal","vec3",N(0,1,0)),qe=Zs.toVar("normalLocal"),Tt=oe(sa.mul(qe),"v_normalView").normalize().toVar("normalView"),jh=oe(Tt.transformDirection(ts),"v_normalWorld").normalize().toVar("transformedNormalWorld"),te=ee("vec3","transformedNormalView"),na=te.transformDirection(ts).normalize().toVar("transformedNormalWorld"),Ut=ee("vec3","transformedClearcoatNormalView"),Sr=new Map;class v extends D{constructor(e){super(),this.scope=e}getCache(e,t){let s=Sr.get(e);return s===void 0&&(s=dt(e,t),Sr.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let o=null;if(s===v.COLOR){const r=this.getColor(s);t.map&&t.map.isTexture===!0?o=r.mul(this.getTexture("map")):o=r}else if(s===v.OPACITY){const r=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?o=r.mul(this.getTexture("alpha")):o=r}else if(s===v.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?o=this.getTexture("specular").r:o=T(1);else if(s===v.SPECULAR_INTENSITY){const r=this.getFloat(s);t.specularMap?o=r.mul(this.getTexture(s).a):o=r}else if(s===v.SPECULAR_COLOR){const r=this.getColor(s);t.specularColorMap&&t.specularColorMap.isTexture===!0?o=r.mul(this.getTexture(s).rgb):o=r}else if(s===v.ROUGHNESS){const r=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?o=r.mul(this.getTexture(s).g):o=r}else if(s===v.METALNESS){const r=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?o=r.mul(this.getTexture(s).b):o=r}else if(s===v.EMISSIVE){const r=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?o=r.mul(this.getTexture(s)):o=r}else if(s===v.NORMAL)t.normalMap?o=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?o=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):o=Tt;else if(s===v.CLEARCOAT){const r=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?o=r.mul(this.getTexture(s).r):o=r}else if(s===v.CLEARCOAT_ROUGHNESS){const r=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?o=r.mul(this.getTexture(s).r):o=r}else if(s===v.CLEARCOAT_NORMAL)t.clearcoatNormalMap?o=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):o=Tt;else if(s===v.SHEEN){const r=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?o=r.mul(this.getTexture("sheenColor").rgb):o=r}else if(s===v.SHEEN_ROUGHNESS){const r=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?o=r.mul(this.getTexture(s).a):o=r,o=o.clamp(.07,1)}else if(s===v.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const r=this.getTexture(s);o=Ao(rs.x,rs.y,rs.y.negate(),rs.x).mul(r.rg.mul(2).sub(b(1)).normalize().mul(r.b))}else o=rs;else if(s===v.IRIDESCENCE_THICKNESS){const r=Ue("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const i=Ue("0","float",t.iridescenceThicknessRange);o=r.sub(i).mul(this.getTexture(s).g).add(i)}else o=r}else if(s===v.TRANSMISSION){const r=this.getFloat(s);t.transmissionMap?o=r.mul(this.getTexture(s).r):o=r}else if(s===v.THICKNESS){const r=this.getFloat(s);t.thicknessMap?o=r.mul(this.getTexture(s).g):o=r}else if(s===v.IOR)o=this.getFloat(s);else{const r=this.getNodeType(e);o=this.getCache(s,r)}return o}}v.ALPHA_TEST="alphaTest";v.COLOR="color";v.OPACITY="opacity";v.SHININESS="shininess";v.SPECULAR="specular";v.SPECULAR_STRENGTH="specularStrength";v.SPECULAR_INTENSITY="specularIntensity";v.SPECULAR_COLOR="specularColor";v.REFLECTIVITY="reflectivity";v.ROUGHNESS="roughness";v.METALNESS="metalness";v.NORMAL="normal";v.CLEARCOAT="clearcoat";v.CLEARCOAT_ROUGHNESS="clearcoatRoughness";v.CLEARCOAT_NORMAL="clearcoatNormal";v.EMISSIVE="emissive";v.ROTATION="rotation";v.SHEEN="sheen";v.SHEEN_ROUGHNESS="sheenRoughness";v.ANISOTROPY="anisotropy";v.IRIDESCENCE="iridescence";v.IRIDESCENCE_IOR="iridescenceIOR";v.IRIDESCENCE_THICKNESS="iridescenceThickness";v.IOR="ior";v.TRANSMISSION="transmission";v.THICKNESS="thickness";v.ATTENUATION_DISTANCE="attenuationDistance";v.ATTENUATION_COLOR="attenuationColor";v.LINE_SCALE="scale";v.LINE_DASH_SIZE="dashSize";v.LINE_GAP_SIZE="gapSize";v.LINE_WIDTH="linewidth";v.LINE_DASH_OFFSET="dashOffset";v.POINT_WIDTH="pointWidth";v.DISPERSION="dispersion";const Kh=A(v,v.ALPHA_TEST),vs=A(v,v.COLOR),Xh=A(v,v.SHININESS),Zh=A(v,v.EMISSIVE),oa=A(v,v.OPACITY),Jh=A(v,v.SPECULAR),Mr=A(v,v.SPECULAR_INTENSITY),Qh=A(v,v.SPECULAR_COLOR),ep=A(v,v.SPECULAR_STRENGTH);A(v,v.REFLECTIVITY);const tp=A(v,v.ROUGHNESS),sp=A(v,v.METALNESS),np=A(v,v.NORMAL),op=A(v,v.CLEARCOAT),rp=A(v,v.CLEARCOAT_ROUGHNESS),ip=A(v,v.CLEARCOAT_NORMAL),ap=A(v,v.ROTATION),cp=A(v,v.SHEEN),up=A(v,v.SHEEN_ROUGHNESS),lp=A(v,v.ANISOTROPY),dp=A(v,v.IRIDESCENCE),hp=A(v,v.IRIDESCENCE_IOR),pp=A(v,v.IRIDESCENCE_THICKNESS),fp=A(v,v.TRANSMISSION),mp=A(v,v.THICKNESS),gp=A(v,v.IOR),yp=A(v,v.ATTENUATION_DISTANCE),Np=A(v,v.ATTENUATION_COLOR),to=A(v,v.LINE_SCALE),ra=A(v,v.LINE_DASH_SIZE),ia=A(v,v.LINE_GAP_SIZE),wn=A(v,v.LINE_WIDTH),Er=A(v,v.LINE_DASH_OFFSET),vp=A(v,v.POINT_WIDTH),Tp=A(v,v.DISPERSION),rs=k(new Ne).onReference(function(n){return n.material}).onRenderUpdate(function({material:n}){this.value.set(n.anisotropy*Math.cos(n.anisotropyRotation),n.anisotropy*Math.sin(n.anisotropyRotation))});w("MaterialNode",v);const xe=ge("position","vec3"),he=xe.toVar("positionLocal"),so=oe(Ns.mul(he).xyz,"v_positionWorld"),xp=oe(he.transformDirection(Ns),"v_positionWorldDirection").normalize().toVar("positionWorldDirection"),ye=oe(Rt.mul(he).xyz,"v_positionView"),Q=oe(ye.negate(),"v_positionViewDirection").normalize().toVar("positionViewDirection");class aa extends H{constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return oe(e.context.mvp);const t=this.positionNode||he;return Qe.mul(Rt).mul(t)}}const Ar=g(aa);w("ModelViewProjectionNode",aa);class ca extends nn{constructor(e,t=null,s=0,o=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=o,this.usage=Yc,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,o=e.getTypeLength(t),r=this.bufferStride||o,i=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Hc(s,r),c=new $c(a,o,i);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),o=e.getPropertyName(s);let r=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=o,r=o):r=oe(this).build(e,t),r}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const mn=(n,e,t,s)=>M(new ca(n,e,t,s)),wp=(n,e,t,s)=>mn(n,e,t,s).setUsage(cs),no=(n,e,t,s)=>mn(n,e,t,s).setInstanced(!0),Rr=(n,e,t,s)=>wp(n,e,t,s).setInstanced(!0);f("toAttribute",n=>mn(n.value));w("BufferAttributeNode",ca);class ua extends D{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=W.FRAME,this.buffer=null,this.bufferColor=null}setup(){let e=this.instanceMatrixNode;const t=this.instanceMesh;if(e===null){const c=t.instanceMatrix,u=new qc(c.array,16,1);this.buffer=u;const l=c.usage===cs?Rr:no,h=[l(u,"vec4",16,0),l(u,"vec4",16,4),l(u,"vec4",16,8),l(u,"vec4",16,12)];e=Yt(...h),this.instanceMatrixNode=e}const s=t.instanceColor;if(s&&this.instanceColorNode===null){const c=new si(s.array,3),u=s.usage===cs?Rr:no;this.bufferColor=c,this.instanceColorNode=N(u(c,"vec3",3,0))}const o=e.mul(he).xyz,r=ve(e[0].xyz,e[1].xyz,e[2].xyz),i=qe.div(N(r[0].dot(r[0]),r[1].dot(r[1]),r[2].dot(r[2]))),a=r.mul(i).xyz;he.assign(o),qe.assign(a),this.instanceColorNode!==null&&Ke("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMesh.instanceMatrix.usage!==cs&&this.instanceMesh.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMesh.instanceMatrix.version),this.instanceMesh.instanceColor&&this.instanceMesh.instanceColor.usage!==cs&&this.instanceMesh.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceMesh.instanceColor.version)}}const bp=g(ua);w("InstanceNode",ua);const la=E((n,e)=>(e.geometry.hasAttribute("tangent")===!1&&e.geometry.computeTangents(),ge("tangent","vec4")))(),Uo=la.xyz.toVar("tangentLocal"),da=oe(Rt.mul(L(Uo,0)).xyz,"v_tangentView").normalize().toVar("tangentView");class ha extends D{constructor(e){super("void"),this.batchMesh=e,this.instanceColorNode=null,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=Lo:this.batchingIdNode=Dd);const t=E(([d])=>{const m=Xs(at(this.batchMesh._indirectTexture),0),y=ie(d).remainder(ie(m)),x=ie(d).div(ie(m));return at(this.batchMesh._indirectTexture,ft(y,x),null,"uvec4").x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),s=this.batchMesh._matricesTexture,o=Xs(at(s),0),r=T(t(ie(this.batchingIdNode))).mul(4).toVar(),i=ie(r.mod(o)),a=ie(r).div(ie(o)),c=Yt(at(s,ft(i,a)),at(s,ft(i.add(1),a)),at(s,ft(i.add(2),a)),at(s,ft(i.add(3),a))),u=ve(c[0].xyz,c[1].xyz,c[2].xyz);he.assign(c.mul(he));const l=qe.div(N(u[0].dot(u[0]),u[1].dot(u[1]),u[2].dot(u[2]))),h=u.mul(l).xyz;qe.assign(h),e.hasGeometryAttribute("tangent")&&Uo.mulAssign(u)}}const Sp=g(ha);w("batch",ha);class pa extends D{constructor(e,t=!1){super("void"),this.skinnedMesh=e,this.useReference=t,this.updateType=W.OBJECT,this.skinIndexNode=ge("skinIndex","uvec4"),this.skinWeightNode=ge("skinWeight","vec4");let s,o,r;t?(s=Ue("bindMatrix","mat4"),o=Ue("bindMatrixInverse","mat4"),r=Hh("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(s=k(e.bindMatrix,"mat4"),o=k(e.bindMatrixInverse,"mat4"),r=zo(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=o,this.boneMatricesNode=r}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:r,boneMatricesNode:i}=this,a=i.element(t.x),c=i.element(t.y),u=i.element(t.z),l=i.element(t.w),h=o.mul(he),d=Re(a.mul(s.x).mul(h),c.mul(s.y).mul(h),u.mul(s.z).mul(h),l.mul(s.w).mul(h)),m=r.mul(d).xyz;let y=Re(s.x.mul(a),s.y.mul(c),s.z.mul(u),s.w.mul(l));y=r.mul(y).mul(o);const x=y.transformDirection(qe).xyz;he.assign(m),qe.assign(x),e.hasGeometryAttribute("tangent")&&Uo.assign(x)}generate(e,t){if(t!=="void")return he.build(e,t)}update(e){(this.useReference?e.object:this.skinnedMesh).skeleton.update()}}const Mp=n=>M(new pa(n,!0));w("SkinningNode",pa);class fa extends D{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let r=0,i=this.params.length-1;r<i;r++){const a=this.params[r],c=a.isNode!==!0&&a.name||this.getVarName(r),u=a.isNode!==!0&&a.type||"int";s[c]=pn(c,u)}const o=e.addStack();return t.returnsNode=this.params[this.params.length-1](s,o,e),t.stackNode=o,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s=this.params,o=t.stackNode;for(let a=0,c=s.length-1;a<c;a++){const u=s[a];let l=null,h=null,d=null,m=null,y=null,x=null;u.isNode?(m="int",d=this.getVarName(a),l="0",h=u.build(e,m),y="<"):(m=u.type||"int",d=u.name||this.getVarName(a),l=u.start,h=u.end,y=u.condition,x=u.update,typeof l=="number"?l=l.toString():l&&l.isNode&&(l=l.build(e,m)),typeof h=="number"?h=h.toString():h&&h.isNode&&(h=h.build(e,m)),l!==void 0&&h===void 0?(l=l+" - 1",h="0",y=">="):h!==void 0&&l===void 0&&(l="0",y="<"),y===void 0&&(Number(l)>Number(h)?y=">=":y="<"));const S={start:l,end:h,condition:y},R=S.start,O=S.end;let I="",j="",U="";x||(m==="int"||m==="uint"?y.includes("<")?x="++":x="--":y.includes("<")?x="+= 1.":x="-= 1."),I+=e.getVar(m,d)+" = "+R,j+=d+" "+y+" "+O,U+=d+" "+x;const z=`for ( ${I}; ${j}; ${U} )`;e.addFlowCode((a===0?`
`:"")+e.tab+z+` {

`).addFlowTab()}const r=o.build(e,"void"),i=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let a=0,c=this.params.length-1;a<c;a++)e.addFlowCode((a===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),i}}const Ye=(...n)=>M(new fa(Gt(n,"int"))).append(),ma=()=>pn("break").append();f("loop",(n,...e)=>Ii(n,Ye(...e)));w("LoopNode",fa);const bn=new WeakMap,Ie=new Nt,Cr=E(({bufferMap:n,influence:e,stride:t,width:s,depth:o,offset:r})=>{const i=ie(Od).mul(t).add(r),a=i.div(s),c=i.sub(a.mul(s));return at(n,ft(c,a)).depth(o).mul(e)});function Ep(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,o=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,r=o!==void 0?o.length:0;let i=bn.get(n);if(i===void 0||i.count!==r){let R=function(){x.dispose(),bn.delete(n),n.removeEventListener("dispose",R)};i!==void 0&&i.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let l=0;e===!0&&(l=1),t===!0&&(l=2),s===!0&&(l=3);let h=n.attributes.position.count*l,d=1;const m=4096;h>m&&(d=Math.ceil(h/m),h=m);const y=new Float32Array(h*d*4*r),x=new jc(y,h,d,r);x.type=Kc,x.needsUpdate=!0;const S=l*4;for(let O=0;O<r;O++){const I=a[O],j=c[O],U=u[O],z=h*d*4*O;for(let G=0;G<I.count;G++){const F=G*S;e===!0&&(Ie.fromBufferAttribute(I,G),y[z+F+0]=Ie.x,y[z+F+1]=Ie.y,y[z+F+2]=Ie.z,y[z+F+3]=0),t===!0&&(Ie.fromBufferAttribute(j,G),y[z+F+4]=Ie.x,y[z+F+5]=Ie.y,y[z+F+6]=Ie.z,y[z+F+7]=0),s===!0&&(Ie.fromBufferAttribute(U,G),y[z+F+8]=Ie.x,y[z+F+9]=Ie.y,y[z+F+10]=Ie.z,y[z+F+11]=U.itemSize===4?Ie.w:1)}}i={count:r,texture:x,stride:l,size:new Ne(h,d)},bn.set(n,i),n.addEventListener("dispose",R)}return i}class ga extends D{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=k(1),this.updateType=W.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,o=t.morphAttributes.normal!==void 0,r=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,i=r!==void 0?r.length:0,{texture:a,stride:c,size:u}=Ep(t);s===!0&&he.mulAssign(this.morphBaseInfluence),o===!0&&qe.mulAssign(this.morphBaseInfluence);const l=ie(u.width);Ye(i,({i:h})=>{const d=T(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(at(this.mesh.morphTexture,ft(ie(h).add(1),ie(Lo))).r):d.assign(Ue("morphTargetInfluences","float").element(h).toVar()),s===!0&&he.addAssign(Cr({bufferMap:a,influence:d,stride:c,width:l,depth:h,offset:ie(0)})),o===!0&&qe.addAssign(Cr({bufferMap:a,influence:d,stride:c,width:l,depth:h,offset:ie(1)}))})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const Ap=g(ga);w("MorphNode",ga);const Rp=Q.negate().reflect(te),Cp=Rp.transformDirection(ts).toVar("reflectVector");class ya extends It{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return Cp}setUpdateMatrix(){}setupUV(e,t){const s=this.value;return e.renderer.coordinateSystem===ni||!s.isRenderTargetTexture?N(t.x.negate(),t.yz):t}generateUV(e,t){return t.build(e,"vec3")}}const Na=g(ya);f("cubeTexture",Na);w("CubeTextureNode",ya);class bs extends D{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}w("LightingNode",bs);let is=null;class wt extends bs{constructor(e=null){super(),this.updateType=W.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.shadowMaskNode=null,this.color=new go,this._defaultColorNode=k(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){const{object:t}=e;if(t.receiveShadow===!1)return;let s=this.shadowNode;if(s===null){is===null&&(is=e.createNodeMaterial(),is.fragmentNode=L(0,0,0,1),is.isShadowNodeMaterial=!0);const o=this.light.shadow,r=e.createRenderTarget(o.mapSize.width,o.mapSize.height),i=new No;i.minFilter=Ho,i.magFilter=Ho,i.image.width=o.mapSize.width,i.image.height=o.mapSize.height,i.compareFunction=Xc,r.depthTexture=i,o.camera.updateProjectionMatrix();const a=Ue("intensity","float",o),c=Ue("bias","float",o),u=Ue("normalBias","float",o),l=t.material.shadowPositionNode||so;let h=k(o.matrix).mul(l.add(jh.mul(u)));h=h.xyz.div(h.w);const d=h.x.greaterThanEqual(0).and(h.x.lessThanEqual(1)).and(h.y.greaterThanEqual(0)).and(h.y.lessThanEqual(1)).and(h.z.lessThanEqual(1));let m=h.z.add(c);e.renderer.coordinateSystem===ni&&(m=m.mul(2).sub(1)),h=N(h.x,h.y.oneMinus(),m),s=((R,O,I)=>de(R,O).compare(I))(i,h.xy,h.z);const x=de(r.texture,h),S=d.mix(1,s.mix(x.a.mix(1,x),1));this.rtt=r,this.colorNode=this.colorNode.mul(re(1,S,a)),this.shadowNode=s,this.shadowMaskNode=S,this.updateBeforeType=W.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:o,scene:r,camera:i}=e,a=r.overrideMaterial;r.overrideMaterial=is,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s),s.shadow.camera.layers.mask=i.layers.mask;const c=o.toneMapping,u=o.getRenderTarget(),l=o.getRenderObjectFunction();o.setRenderObjectFunction((h,...d)=>{h.castShadow===!0&&o.renderObject(h,...d)}),o.setRenderTarget(t),o.toneMapping=fs,o.render(r,s.shadow.camera),o.setRenderTarget(u),o.setRenderObjectFunction(l),o.toneMapping=c,r.overrideMaterial=a}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.shadowMaskNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}w("AnalyticLightNode",wt);const Js=new WeakMap,Lp=n=>n.sort((e,t)=>e.id-t.id);class Ip extends D{constructor(e=[]){super("vec3"),this.totalDiffuseNode=N().temp("totalDiffuse"),this.totalSpecularNode=N().temp("totalSpecular"),this.outgoingLightNode=N().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}analyze(e){const t=e.getDataFromNode(this);for(const s of t.nodes)s.build(e)}setup(e){const t=e.context,s=t.lightingModel;let o=this.outgoingLightNode;if(s){const{lightNodes:r,totalDiffuseNode:i,totalSpecularNode:a}=this;t.outgoingLight=o;const c=e.addStack(),u=e.getDataFromNode(this);u.nodes=c.nodes,s.start(t,c,e);for(const R of r)R.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:l,backdropAlpha:h}=t,{directDiffuse:d,directSpecular:m,indirectDiffuse:y,indirectSpecular:x}=t.reflectedLight;let S=d.add(y);l!==null&&(h!==null?S=N(h.mix(S,l)):S=N(l),t.material.transparent=!0),i.assign(S),a.assign(m.add(x)),o.assign(i.add(a)),s.finish(t,c,e),o=o.bypass(e.removeStack())}return o}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=Lp(e);for(const s of e){let o=this._getLightNodeById(s.id);if(o===null){const r=s.constructor,i=Js.has(r)?Js.get(r):wt;o=M(new i(s))}t.push(o)}return this.lightNodes=t,this._hash=null,this}}const Op=g(Ip);function Dt(n,e){if(Js.has(n)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof n!="function")throw new Error(`Light ${n.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);Js.set(n,e)}class va extends bs{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}w("AONode",va);class Ta extends Co{constructor(e,t=null,s=null,o=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=o,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=N().temp("directDiffuse"),o=N().temp("directSpecular"),r=N().temp("indirectDiffuse"),i=N().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:o,indirectDiffuse:r,indirectSpecular:i};return{radiance:N().temp("radiance"),irradiance:N().temp("irradiance"),iblIrradiance:N().temp("iblIrradiance"),ambientOcclusion:T(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const xa=g(Ta);f("lightingContext",xa);w("LightingContextNode",Ta);const Dp=n=>n.mul(la.w).xyz,_p=oe(Dp(Tt.cross(da)),"v_bitangentView").normalize().toVar("bitangentView"),Pt=ve(da,_p,Tt);Q.mul(Pt);const kp=(()=>{let n=Ht.cross(Q);return n=n.cross(Ht).normalize(),n=re(n,te,Mt.mul(ct.oneMinus()).oneMinus().pow2().pow2()).normalize(),n})();class Po extends D{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}setup(e){const t=e.getNodeProperties(this);t.condNode=this.condNode.cache(),t.ifNode=this.ifNode.cache(),t.elseNode=this.elseNode?this.elseNode.cache():null}generate(e,t){const s=this.getNodeType(e),o=e.getDataFromNode(this);if(o.nodeProperty!==void 0)return o.nodeProperty;const{condNode:r,ifNode:i,elseNode:a}=e.getNodeProperties(this),c=t!=="void",u=c?ee(s).build(e):"";o.nodeProperty=u;const l=r.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${l} ) {

`).addFlowTab();let h=i.build(e,s);if(h&&(c?h=u+" = "+h+";":h="return "+h+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+h+`

`+e.tab+"}"),a!==null){e.addFlowCode(` else {

`).addFlowTab();let d=a.build(e,s);d&&(c?d=u+" = "+d+";":d="return "+d+";"),e.removeFlowTab().addFlowCode(e.tab+"	"+d+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(u,s,t)}}const Fe=g(Po);f("cond",Fe);w("CondNode",Po);const Lr=T(1),oo=T(-2),Cs=T(.8),Sn=T(-1),Ls=T(.4),Mn=T(2),Is=T(.305),En=T(3),Ir=T(.21),Vp=T(4),Or=T(4),zp=T(16),Fp=E(([n])=>{const e=N(Je(n)).toVar(),t=T(-1).toVar();return se(e.x.greaterThan(e.z),()=>{se(e.x.greaterThan(e.y),()=>{t.assign(Fe(n.x.greaterThan(0),0,3))}).else(()=>{t.assign(Fe(n.y.greaterThan(0),1,4))})}).else(()=>{se(e.z.greaterThan(e.y),()=>{t.assign(Fe(n.z.greaterThan(0),2,5))}).else(()=>{t.assign(Fe(n.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Up=E(([n,e])=>{const t=b().toVar();return se(e.equal(0),()=>{t.assign(b(n.z,n.y).div(Je(n.x)))}).elseif(e.equal(1),()=>{t.assign(b(n.x.negate(),n.z.negate()).div(Je(n.y)))}).elseif(e.equal(2),()=>{t.assign(b(n.x.negate(),n.y).div(Je(n.z)))}).elseif(e.equal(3),()=>{t.assign(b(n.z.negate(),n.y).div(Je(n.x)))}).elseif(e.equal(4),()=>{t.assign(b(n.x.negate(),n.z).div(Je(n.y)))}).else(()=>{t.assign(b(n.x,n.y).div(Je(n.z)))}),q(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Pp=E(([n])=>{const e=T(0).toVar();return se(n.greaterThanEqual(Cs),()=>{e.assign(Lr.sub(n).mul(Sn.sub(oo)).div(Lr.sub(Cs)).add(oo))}).elseif(n.greaterThanEqual(Ls),()=>{e.assign(Cs.sub(n).mul(Mn.sub(Sn)).div(Cs.sub(Ls)).add(Sn))}).elseif(n.greaterThanEqual(Is),()=>{e.assign(Ls.sub(n).mul(En.sub(Mn)).div(Ls.sub(Is)).add(Mn))}).elseif(n.greaterThanEqual(Ir),()=>{e.assign(Is.sub(n).mul(Vp.sub(En)).div(Is.sub(Ir)).add(En))}).else(()=>{e.assign(T(-2).mul(un(q(1.16,n))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]});E(([n,e])=>{const t=n.toVar();t.assign(q(2,t).sub(1));const s=N(t,1).toVar();return se(e.equal(0),()=>{s.assign(s.zyx)}).elseif(e.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).elseif(e.equal(2),()=>{s.x.mulAssign(-1)}).elseif(e.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).elseif(e.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).elseif(e.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]});const Bp=E(([n,e,t,s,o,r])=>{const i=T(t),a=N(e),c=At(Pp(i),oo,r),u=dn(c),l=ln(c),h=N(ro(n,a,l,s,o,r)).toVar();return se(u.notEqual(0),()=>{const d=N(ro(n,a,l.add(1),s,o,r)).toVar();h.assign(re(h,d,u))}),h}),ro=E(([n,e,t,s,o,r])=>{const i=T(t).toVar(),a=N(e),c=T(Fp(a)).toVar(),u=T(be(Or.sub(i),0)).toVar();i.assign(be(i,Or));const l=T(Jn(i)).toVar(),h=b(Up(a,c).mul(l.sub(2)).add(1)).toVar();return se(c.greaterThan(2),()=>{h.y.addAssign(l),c.subAssign(3)}),h.x.addAssign(c.mul(l)),h.x.addAssign(u.mul(q(3,zp))),h.y.addAssign(q(4,Jn(r).sub(l))),h.x.mulAssign(s),h.y.mulAssign(o),n.uv(h).grad(b(),b())}),An=E(({envMap:n,mipInt:e,outputDirection:t,theta:s,axis:o,CUBEUV_TEXEL_WIDTH:r,CUBEUV_TEXEL_HEIGHT:i,CUBEUV_MAX_MIP:a})=>{const c=Ze(s),u=t.mul(c).add(o.cross(t).mul(_e(s))).add(o.mul(o.dot(t).mul(c.oneMinus())));return ro(n,u,e,r,i,a)});E(({n,latitudinal:e,poleAxis:t,outputDirection:s,weights:o,samples:r,dTheta:i,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:h})=>{const d=N(Fe(e,t,$i(t,s))).toVar();se(Wi(d.equals(N(0))),()=>{d.assign(N(s.z,0,s.x.negate()))}),d.assign(ys(d));const m=N().toVar();return m.addAssign(o.element(ie(0)).mul(An({theta:0,axis:d,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:h}))),Ye({start:ie(1),end:n},({i:y})=>{se(y.greaterThanEqual(r),()=>{ma()});const x=T(i.mul(T(y))).toVar();m.addAssign(o.element(y).mul(An({theta:x.mul(-1),axis:d,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:h}))),m.addAssign(o.element(y).mul(An({theta:x,axis:d,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:u,CUBEUV_TEXEL_HEIGHT:l,CUBEUV_MAX_MIP:h})))}),L(m,1)});let Qs=null;const Dr=new WeakMap;function Wp(n){const e=Math.log2(n)-2,t=1/n;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function Gp(n){let e=Dr.get(n);if((e!==void 0?e.pmremVersion:-1)!==n.pmremVersion){if(n.isCubeTexture){if(n.source.data.some(s=>s===void 0))throw new Error("PMREMNode: Undefined texture in CubeTexture. Use onLoad callback or async loader");e=Qs.fromCubemap(n,e)}else{if(n.image===void 0)throw new Error("PMREMNode: Undefined image in Texture. Use onLoad callback or async loader");e=Qs.fromEquirectangular(n,e)}e.pmremVersion=n.pmremVersion,Dr.set(n,e)}return e.texture}class wa extends H{constructor(e,t=null,s=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=s,this._generator=null,this._texture=de(null),this._width=k(0),this._height=k(0),this._maxMip=k(0),this.updateBeforeType=W.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=Wp(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(){let e=this._pmrem;const t=e?e.pmremVersion:-1,s=this._value;t!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=Gp(s),this._pmrem=e,this.updateFromTexture(e))}setup(e){Qs===null&&(Qs=e.createPMREMGenerator()),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this));const s=this.value;e.renderer.coordinateSystem===oi&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(t=N(t.x.negate(),t.yz));let o=this.levelNode;return o===null&&e.context.getTextureLevel&&(o=e.context.getTextureLevel(this)),Bp(this._texture,t,o,this._width,this._height,this._maxMip)}}const Yp=g(wa);w("PMREMNode",wa);const _r=new WeakMap;class ba extends bs{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode){let m=_r.get(t.value);m===void 0&&(m=Yp(t.value),_r.set(t.value,m)),t=m}const{material:s}=e,r=s.envMap?Ue("envMapIntensity","float",e.material):Ue("environmentIntensity","float",e.scene),a=s.useAnisotropy===!0||s.anisotropy>0?kp:te,c=ps(t,kr(ct,a)).mul(r),u=ps(t,Hp(na)).mul(Math.PI).mul(r),l=ks(c),h=ks(u);e.context.radiance.addAssign(l),e.context.iblIrradiance.addAssign(h);const d=e.context.lightingModel.clearcoatRadiance;if(d){const m=ps(t,kr(qs,Ut)).mul(r),y=ks(m);d.addAssign(y)}}}const kr=(n,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Q.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(ts)),t),getTextureLevel:()=>n}},Hp=n=>({getUV:()=>n,getTextureLevel:()=>T(1)});w("EnvironmentNode",ba);class Sa extends bs{constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}w("IrradianceNode",Sa);let Rn,Cn;class Y extends D{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Y.VIEWPORT?"vec4":this.scope===Y.COORDINATE?"vec3":"vec2"}getUpdateType(){let e=W.NONE;return(this.scope===Y.RESOLUTION||this.scope===Y.VIEWPORT)&&(e=W.RENDER),this.updateType=e,e}update({renderer:e}){this.scope===Y.VIEWPORT?e.getViewport(Cn):e.getDrawingBufferSize(Rn)}setup(){const e=this.scope;let t=null;if(e===Y.RESOLUTION)t=k(Rn||(Rn=new Ne));else if(e===Y.VIEWPORT)t=k(Cn||(Cn=new Nt));else{t=$p.div(io);let s=t.x,o=t.y;/bottom/i.test(e)&&(o=o.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=b(s,o)}return t}generate(e){if(this.scope===Y.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(io).outputNode.build(e);t=`${e.getType("vec3")}( ${t}.x, ${s}.y - ${t}.y, ${t}.z )`}return t}return super.generate(e)}}Y.COORDINATE="coordinate";Y.RESOLUTION="resolution";Y.VIEWPORT="viewport";Y.TOP_LEFT="topLeft";Y.BOTTOM_LEFT="bottomLeft";Y.TOP_RIGHT="topRight";Y.BOTTOM_RIGHT="bottomRight";const $p=A(Y,Y.COORDINATE),io=A(Y,Y.RESOLUTION),jt=A(Y,Y.VIEWPORT),Ts=A(Y,Y.TOP_LEFT);A(Y,Y.BOTTOM_LEFT);A(Y,Y.TOP_RIGHT);A(Y,Y.BOTTOM_RIGHT);w("ViewportNode",Y);const as=new Ne;class Ss extends It{constructor(e=Ts,t=null,s=null){s===null&&(s=new ri,s.minFilter=Zc),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=W.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(as);const s=this.value;(s.image.width!==as.width||s.image.height!==as.height)&&(s.image.width=as.width,s.image.height=as.height,s.needsUpdate=!0);const o=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=o}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const qp=g(Ss),Ma=g(Ss,null,null,{generateMipmaps:!0});f("viewportTexture",qp);f("viewportMipTexture",Ma);w("ViewportTextureNode",Ss);let Ln=null;class Ea extends Ss{constructor(e=Ts,t=null){Ln===null&&(Ln=new No),super(e,t,Ln)}}const Aa=g(Ea);f("viewportDepthTexture",Aa);w("ViewportDepthTextureNode",Ea);class Ve extends D{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===Ve.DEPTH?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,s=this.valueNode;let o=null;if(t===Ve.DEPTH)s!==null?o=Ca().assign(s):e.isPerspectiveCamera?o=jp(ye.z,ns,os):o=Fs(ye.z,ns,os);else if(t===Ve.LINEAR_DEPTH)if(s!==null)if(e.isPerspectiveCamera){const r=Ra(s,ns,os);o=Fs(r,ns,os)}else o=s;else o=Fs(ye.z,ns,os);return o}}const Fs=(n,e,t)=>n.add(e).div(e.sub(t)),jp=(n,e,t)=>e.add(n).mul(t).div(t.sub(e).mul(n)),Ra=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t));Ve.DEPTH="depth";Ve.LINEAR_DEPTH="linearDepth";const Ca=g(Ve,Ve.DEPTH),La=A(Ve,Ve.DEPTH),Kp=g(Ve,Ve.LINEAR_DEPTH);Kp(Aa());La.assign=n=>Ca(n);w("ViewportDepthNode",Ve);class xt extends D{constructor(e=xt.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{localClipIntersection:s,localClippingCount:o,globalClippingCount:r}=t,i=r+o,a=s?i-o:i;return this.scope===xt.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(t.planes,i,a):this.setupDefault(t.planes,i,a)}setupAlphaToCoverage(e,t,s){return E(()=>{const o=Qn(e),r=ee("float","distanceToPlane"),i=ee("float","distanceToGradient"),a=ee("float","clipOpacity");a.assign(1);let c;if(Ye(s,({i:u})=>{c=o.element(u),r.assign(ye.dot(c.xyz).negate().add(c.w)),i.assign(r.fwidth().div(2)),a.mulAssign(st(i.negate(),i,r)),a.equal(0).discard()}),s<t){const u=ee("float","unionclipOpacity");u.assign(1),Ye({start:s,end:t},({i:l})=>{c=o.element(l),r.assign(ye.dot(c.xyz).negate().add(c.w)),i.assign(r.fwidth().div(2)),u.mulAssign(st(i.negate(),i,r).oneMinus())}),a.mulAssign(u.oneMinus())}X.a.mulAssign(a),X.a.equal(0).discard()})()}setupDefault(e,t,s){return E(()=>{const o=Qn(e);let r;if(Ye(s,({i})=>{r=o.element(i),ye.dot(r.xyz).greaterThan(r.w).discard()}),s<t){const i=ee("bool","clipped");i.assign(!0),Ye({start:s,end:t},({i:a})=>{r=o.element(a),i.assign(ye.dot(r.xyz).greaterThan(r.w).and(i))}),i.discard()}})()}}xt.ALPHA_TO_COVERAGE="alphaToCoverage";xt.DEFAULT="default";const Xp=()=>M(new xt),Zp=()=>M(new xt(xt.ALPHA_TO_COVERAGE));class Ia extends D{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:s}=e;return t.coordinateSystem===oi&&s.side===Jc?"false":e.getFrontFacing()}}const Jp=A(Ia),en=T(Jp).mul(2).sub(1);w("FrontFacingNode",Ia);const ao=new Map;class Te extends $o{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.shadowNode=null,this.shadowPositionNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Ti(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;const s=this.setupClipping(e);if(this.depthWrite===!0&&this.setupDepth(e),this.fragmentNode===null){this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const o=this.setupLighting(e);s!==null&&e.stack.add(s);const r=L(o,X.a).max(0);t=this.setupOutput(e,r),_d.assign(t),this.outputNode!==null&&(t=this.outputNode)}else{let o=this.fragmentNode;o.isOutputStructNode!==!0&&(o=L(o)),t=this.setupOutput(e,o)}e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupClipping(e){if(e.clippingContext===null)return null;const{globalClippingCount:t,localClippingCount:s}=e.clippingContext;let o=null;return(t||s)&&(this.alphaToCoverage?o=Zp():e.stack.add(Xp())),o}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=Ar().w.add(1).log2().mul($h).mul(.5)),s!==null&&La.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;if(e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&Ap(t).append(),t.isSkinnedMesh===!0&&Mp(t).append(),this.displacementMap){const r=dt("displacementMap","texture"),i=dt("displacementScale","float"),a=dt("displacementBias","float");he.addAssign(qe.normalize().mul(r.x.mul(i).add(a)))}t.isBatchedMesh&&Sp(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&bp(t).append(),this.positionNode!==null&&he.assign(this.positionNode);const o=Ar();return e.context.vertex=e.removeStack(),e.context.mvp=o,o}setupDiffuseColor({object:e,geometry:t}){let s=this.colorNode?L(this.colorNode):vs;this.vertexColors===!0&&t.hasAttribute("color")&&(s=L(s.xyz.mul(ge("color","vec3")),s.a)),e.instanceColor&&(s=Ke("vec3","vInstanceColor").mul(s)),X.assign(s);const o=this.opacityNode?T(this.opacityNode):oa;if(X.a.assign(X.a.mul(o)),this.alphaTestNode!==null||this.alphaTest>0){const r=this.alphaTestNode!==null?T(this.alphaTestNode):Kh;X.a.lessThanEqual(r).discard()}this.transparent===!1&&this.blending===Qc&&this.alphaToCoverage===!1&&X.a.assign(1)}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=ye.dFdx().cross(ye.dFdy()).normalize();te.assign(e.mul(en))}else{const e=this.normalNode?N(this.normalNode):np;te.assign(e.mul(en))}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?Na(this.envMap):de(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];if(t&&s.push(new ba(t)),e.material.lightMap&&s.push(new Sa(dt("lightMap","texture"))),this.aoNode!==null||e.material.aoMap){const r=this.aoNode!==null?this.aoNode:de(e.material.aoMap);s.push(new va(r))}let o=this.lightsNode||e.lightsNode;return s.length>0&&(o=Op([...o.lightNodes,...s])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:o,emissiveNode:r}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=X.rgb;if(a&&a.hasLight!==!1){const u=this.setupLightingModel(e);c=xa(a,u,s,o)}else s!==null&&(c=N(o!==null?re(c,s,o):s));return(r&&r.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(N(r||Zh))),c}setupOutput(e,t){if(this.fog===!0){const s=e.fogNode;s&&(t=L(s.mix(t.rgb,s.colorNode),t.a))}return t}setDefaultValues(e){for(const s in e){const o=e[s];this[s]===void 0&&(this[s]=o,o&&o.clone&&(this[s]=o.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=$o.prototype.toJSON.call(this,e),o=Ys(this);s.inputNodes={};for(const{property:i,childNode:a}of o)s.inputNodes[i]=a.toJSON(e).uuid;function r(i){const a=[];for(const c in i){const u=i[c];delete u.metadata,a.push(u)}return a}if(t){const i=r(e.textures),a=r(e.images),c=r(e.nodes);i.length>0&&(s.textures=i),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.shadowNode=e.shadowNode,this.shadowPositionNode=e.shadowPositionNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=Oa(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const o in e)s[o]=e[o];return s}}function le(n,e){if(typeof e!="function"||!n)throw new Error(`Node material ${n} is not a class`);if(ao.has(n)){console.warn(`Redefinition of node material ${n}`);return}ao.set(n,e),e.type=n}function Oa(n){const e=ao.get(n);if(e!==void 0)return new e}le("NodeMaterial",Te);class Da extends D{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new hs(t);return this._currentCond=Fe(e,s),this.add(this._currentCond)}elseif(e,t){const s=new hs(t),o=Fe(e,s);return this._currentCond.elseNode=o,this._currentCond=o,this}else(e){return this._currentCond.elseNode=new hs(e),this}build(e,...t){const s=id();xr(this);for(const o of this.nodes)o.build(e,"void");return xr(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}g(Da);w("StackNode",Da);class _a extends H{constructor(e=xp){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return b(t,s)}}g(_a);w("EquirectUVNode",_a);class ka extends D{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}w("StructTypeNode",ka);class Va extends D{constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}setup(e){super.setup(e);const t=this.members,s=[];for(let o=0;o<t.length;o++)s.push(t[o].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new ka(s)).name}generate(e,t){const s=e.getOutputStructName(),o=this.members,r=s!==""?s+".":"";for(let i=0;i<o.length;i++){const a=o[i].build(e,t);e.addLineFlowCode(`${r}m${i} = ${a}`)}return s}}g(Va);w("OutputStructNode",Va);class za extends D{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}}const Qp=g(za);f("hash",Qp);w("HashNode",za);const co=(n,e)=>lt(q(4,n.mul(tt(1,n))),e),ef=(n,e)=>n.lessThan(.5)?co(n.mul(2),e).div(2):tt(1,co(q(tt(1,n),2),e).div(2)),tf=(n,e,t)=>lt(ht(lt(n,e),Re(lt(n,e),lt(tt(1,n),t))),1/e),sf=(n,e)=>_e(wr.mul(e.mul(n).sub(1))).div(wr.mul(e.mul(n).sub(1)));f("parabola",co);f("gain",ef);f("pcurve",tf);f("sinc",sf);const et=E(([n])=>n.fract().sub(.5).abs()),Fa=E(([n])=>N(et(n.z.add(et(n.y.mul(1)))),et(n.z.add(et(n.x.mul(1)))),et(n.y.add(et(n.x.mul(1)))))),nf=E(([n,e,t])=>{const s=N(n).toVar(),o=T(1.4).toVar(),r=T(0).toVar(),i=N(s).toVar();return Ye({start:T(0),end:T(3),type:"float",condition:"<="},()=>{const a=N(Fa(i.mul(2))).toVar();s.addAssign(a.add(t.mul(T(.1).mul(e)))),i.mulAssign(1.8),o.mulAssign(1.5),s.mulAssign(1.2);const c=T(et(s.z.add(et(s.x.add(et(s.y)))))).toVar();r.addAssign(c.div(o)),i.addAssign(.14)}),r});et.setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]});Fa.setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});nf.setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});let In;class Ua extends Po{constructor(e){In=In||pn("discard"),super(e,In)}}const of=g(Ua),rf=n=>of(n).append();f("discard",rf);w("DiscardNode",Ua);class Pa extends D{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let o=null,r=-1;for(const i of this.functionNodes){const c=i.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=c.inputs;if(t.length===u.length){let l=0;for(let h=0;h<t.length;h++){const d=t[h],m=u[h];d.getNodeType(e)===m.type?l++:l=0}l>r&&(o=i,r=l)}}this._candidateFnCall=s=o(...t)}return s}}g(Pa);w("FunctionOverloadingNode",Pa);class Ba extends H{constructor(){super("vec2")}setup(){const e=N(Q.z,0,Q.x.negate()).normalize(),t=Q.cross(e);return b(e.dot(te),t.dot(te)).mul(.495).add(.5)}}const af=A(Ba);w("MatcapUVNode",Ba);class Me extends Lt{constructor(e=Me.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=W.FRAME}update(e){const t=this.scope,s=this.scale;t===Me.LOCAL?this.value+=e.deltaTime*s:t===Me.DELTA?this.value=e.deltaTime*s:t===Me.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Me.LOCAL="local";Me.GLOBAL="global";Me.DELTA="delta";Me.FRAME="frame";const cf=(n,e=0)=>M(new Me(Me.LOCAL,n,e));A(Me,Me.FRAME).toUint();w("TimerNode",Me);class ae extends D{constructor(e=ae.SINE,t=cf()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=M(this.timeNode);let s=null;return e===ae.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===ae.SQUARE?s=t.fract().round():e===ae.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===ae.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}ae.SINE="sine";ae.SQUARE="square";ae.TRIANGLE="triangle";ae.SAWTOOTH="sawtooth";g(ae,ae.SINE);g(ae,ae.SQUARE);g(ae,ae.TRIANGLE);g(ae,ae.SAWTOOTH);w("OscNode",ae);class nt extends H{constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===nt.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===nt.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}nt.DIRECTION_TO_COLOR="directionToColor";nt.COLOR_TO_DIRECTION="colorToDirection";const Wa=g(nt,nt.DIRECTION_TO_COLOR),uf=g(nt,nt.COLOR_TO_DIRECTION);f("directionToColor",Wa);f("colorToDirection",uf);w("PackingNode",nt);class Bo extends D{constructor(e,t,s,o=T(0),r=T(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=o,this.outHighNode=r,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:o,outHighNode:r,doClamp:i}=this;let a=e.sub(t).div(s.sub(t));return i===!0&&(a=a.clamp()),a.mul(r.sub(o)).add(o)}}const lf=g(Bo,null,null,{doClamp:!1}),df=g(Bo);f("remap",lf);f("remapClamp",df);w("RemapNode",Bo);class Ga extends H{constructor(e,t,s=b(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this;return e.sub(s).rotate(t).add(s)}}const hf=g(Ga);f("rotateUV",hf);w("RotateUVNode",Ga);class Ya extends H{constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:s}=this;if(this.getNodeType(e)==="vec2"){const r=t.cos(),i=t.sin();return Ao(r,i,i.negate(),r).mul(s)}else{const r=t,i=Yt(L(1,0,0,0),L(0,Ze(r.x),_e(r.x).negate(),0),L(0,_e(r.x),Ze(r.x),0),L(0,0,0,1)),a=Yt(L(Ze(r.y),0,_e(r.y),0),L(0,1,0,0),L(_e(r.y).negate(),0,Ze(r.y),0),L(0,0,0,1)),c=Yt(L(Ze(r.z),_e(r.z).negate(),0,0),L(_e(r.z),Ze(r.z),0,0),L(0,0,1,0),L(0,0,0,1));return i.mul(a).mul(c).mul(L(s,1)).xyz}}}const pf=g(Ya);f("rotate",pf);w("RotateNode",Ya);class Ha extends D{constructor(e,t=Le(),s=T(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:o,height:r}=s,i=e.mod(o.mul(r)).floor(),a=i.mod(o),c=r.sub(i.add(1).div(o).ceil()),u=s.reciprocal(),l=b(a,c);return t.add(l).mul(u)}}g(Ha);w("SpriteSheetUVNode",Ha);class $a extends Qt{constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}setup(e){return e.isAvailable("storageBuffer")===!1&&!this.node.instanceIndex&&this.node.bufferObject===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let s;const o=e.context.assign;if(e.isAvailable("storageBuffer")===!1){const{node:r}=this;!r.instanceIndex&&this.node.bufferObject===!0&&o!==!0?s=e.generatePBO(this):s=r.build(e)}else s=super.generate(e);if(o!==!0){const r=this.getNodeType(e);s=e.format(s,r,t)}return s}}const qa=g($a);f("storageElement",qa);w("StorageArrayElementNode",$a);class ja extends D{constructor(e,t=null,s=null,o=T(1),r=he,i=qe){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=o,this.positionNode=r,this.normalNode=i}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:o,positionNode:r,normalNode:i}=this;let a=i.abs().normalize();a=a.div(a.dot(N(1)));const c=r.yz.mul(o),u=r.zx.mul(o),l=r.xy.mul(o),h=e.value,d=t!==null?t.value:h,m=s!==null?s.value:h,y=de(h,c).mul(a.x),x=de(d,u).mul(a.y),S=de(m,l).mul(a.z);return Re(y,x,S)}}const ff=g(ja),mf=(...n)=>ff(...n);f("triplanarTexture",mf);w("TriplanarTexturesNode",ja);new eu;new Se;new Se;new Se;new ws;new Se(0,0,-1);new Nt;new Se;new Se;new Nt;new Ne;new vt;b(Ts.x.oneMinus(),Ts.y);class gf extends Ro{constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),s=e.hasGeometryAttribute(t);let o;return s===!0?o=super.generate(e):o=e.generateConst(this.nodeType,new Nt(1,1,1,1)),o}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}w("VertexColorNode",gf);class Ka extends es{constructor(e,t,s=null){super(e,t,s),this.renderer=s}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const yf=(n,e,t)=>M(new Ka(n,e,t));w("RendererReferenceNode",Ka);const gn=1/6,Xa=n=>q(gn,q(n,q(n,n.negate().add(3)).sub(3)).add(1)),uo=n=>q(gn,q(n,q(n,q(3,n).sub(6))).add(4)),Za=n=>q(gn,q(n,q(n,q(-3,n).add(3)).add(3)).add(1)),lo=n=>q(gn,lt(n,3)),Vr=n=>Xa(n).add(uo(n)),zr=n=>Za(n).add(lo(n)),Fr=n=>Re(-1,uo(n).div(Xa(n).add(uo(n)))),Ur=n=>Re(1,lo(n).div(Za(n).add(lo(n)))),Pr=(n,e,t)=>{const s=n.uvNode,o=q(s,e.zw).add(.5),r=ln(o),i=dn(o),a=Vr(i.x),c=zr(i.x),u=Fr(i.x),l=Ur(i.x),h=Fr(i.y),d=Ur(i.y),m=b(r.x.add(u),r.y.add(h)).sub(.5).mul(e.xy),y=b(r.x.add(l),r.y.add(h)).sub(.5).mul(e.xy),x=b(r.x.add(u),r.y.add(d)).sub(.5).mul(e.xy),S=b(r.x.add(l),r.y.add(d)).sub(.5).mul(e.xy),R=Vr(i.y).mul(Re(a.mul(n.uv(m).level(t)),c.mul(n.uv(y).level(t)))),O=zr(i.y).mul(Re(a.mul(n.uv(x).level(t)),c.mul(n.uv(S).level(t))));return R.add(O)},Nf=(n,e)=>{const t=b(n.size(ie(e))),s=b(n.size(ie(e.add(1)))),o=ht(1,t),r=ht(1,s),i=Pr(n,L(o,t),ln(e)),a=Pr(n,L(r,s),Hi(e));return dn(e).mix(i,a)};class Ja extends H{constructor(e,t=T(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return Nf(this.textureNode,this.blurNode)}}const vf=g(Ja);f("bicubic",vf);w("TextureBicubicNode",Ja);class Qa extends D{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}A(Qa);w("PointUVNode",Qa);class He extends D{constructor(e=He.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let o;return t===He.BACKGROUND_BLURRINESS?o=Ue("backgroundBlurriness","float",s):t===He.BACKGROUND_INTENSITY?o=Ue("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),o}}He.BACKGROUND_BLURRINESS="backgroundBlurriness";He.BACKGROUND_INTENSITY="backgroundIntensity";A(He,He.BACKGROUND_BLURRINESS);A(He,He.BACKGROUND_INTENSITY);w("SceneNode",He);const Br={Uniform:"uniform",Storage:"storage",ReadOnlyStorage:"read-only-storage"},On={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"};class Tf extends fn{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0,this.access=Br.Storage,this.bufferObject=!1,this.bufferCount=s,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return"storageBuffer"}element(e){return qa(this,e)}setBufferObject(e){return this.bufferObject=e,this}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Br.ReadOnlyStorage)}generate(e){if(e.isAvailable("storageBuffer"))return super.generate(e);const t=this.getNodeType(e);this._attribute===null&&(this._attribute=mn(this.value),this._varying=oe(this._attribute));const s=this._varying.build(e,t);return e.registerTransform(s,this._attribute),s}}w("StorageBufferNode",Tf);class ec extends It{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStorageTextureNode=!0,this.access=On.WriteOnly}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);t.storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,t){let s;return this.storeNode!==null?s=this.generateStore(e):s=super.generate(e,t),s}toReadOnly(){return this.setAccess(On.ReadOnly)}toWriteOnly(){return this.setAccess(On.WriteOnly)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:s,storeNode:o}=t,r=super.generate(e,"property"),i=s.build(e,"uvec2"),a=o.build(e,"vec4"),c=e.generateTextureStore(e,r,i,a);e.addLineFlowCode(c)}}g(ec);w("StorageTextureNode",ec);const xf=E(({texture:n,uv:e})=>{const s=N().temp();return se(e.x.lessThan(1e-4),()=>{s.assign(N(1,0,0))}).elseif(e.y.lessThan(1e-4),()=>{s.assign(N(0,1,0))}).elseif(e.z.lessThan(1e-4),()=>{s.assign(N(0,0,1))}).elseif(e.x.greaterThan(1-1e-4),()=>{s.assign(N(-1,0,0))}).elseif(e.y.greaterThan(1-1e-4),()=>{s.assign(N(0,-1,0))}).elseif(e.z.greaterThan(1-1e-4),()=>{s.assign(N(0,0,-1))}).else(()=>{const r=n.uv(e.add(N(-.01,0,0))).r.sub(n.uv(e.add(N(.01,0,0))).r),i=n.uv(e.add(N(0,-.01,0))).r.sub(n.uv(e.add(N(0,.01,0))).r),a=n.uv(e.add(N(0,0,-.01))).r.sub(n.uv(e.add(N(0,0,.01))).r);s.assign(N(r,i,a))}),s.normalize()});class tc extends It{constructor(e,t=null,s=null){super(e,t,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return N(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){return t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return xf({texture:this,uv:e})}}const wf=g(tc);w("Texture3DNode",tc);class bf extends es{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}w("UserDataNode",bf);const Sf=E(({base:n,blend:e})=>{const t=s=>e[s].lessThan(Bi).cond(e[s],n[s].oneMinus().div(e[s]).oneMinus().max(0));return N(t("x"),t("y"),t("z"))}).setLayout({name:"burnColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Mf=E(({base:n,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],n[s].div(e[s].oneMinus()).max(0));return N(t("x"),t("y"),t("z"))}).setLayout({name:"dodgeColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Ef=E(({base:n,blend:e})=>{const t=s=>n[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return N(t("x"),t("y"),t("z"))}).setLayout({name:"screenColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Af=E(({base:n,blend:e})=>{const t=s=>n[s].lessThan(.5).cond(n[s].mul(e[s],2),n[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return N(t("x"),t("y"),t("z"))}).setLayout({name:"overlayColor",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]});class ue extends H{constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,o={base:t,blend:s};let r=null;return e===ue.BURN?r=Sf(o):e===ue.DODGE?r=Mf(o):e===ue.SCREEN?r=Ef(o):e===ue.OVERLAY&&(r=Af(o)),r}}ue.BURN="burn";ue.DODGE="dodge";ue.SCREEN="screen";ue.OVERLAY="overlay";const Rf=g(ue,ue.BURN),Cf=g(ue,ue.DODGE),Lf=g(ue,ue.OVERLAY),If=g(ue,ue.SCREEN);f("burn",Rf);f("dodge",Cf);f("overlay",Lf);f("screen",If);w("BlendModeNode",ue);const Of=E(({textureNode:n,bumpScale:e})=>{const t=o=>n.cache().context({getUV:r=>o(r.uvNode||Le()),forceUVContext:!0}),s=T(t(o=>o));return b(T(t(o=>o.add(o.dFdx()))).sub(s),T(t(o=>o.add(o.dFdy()))).sub(s)).mul(e)}),Df=E(n=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=n,o=e.dFdx().normalize(),r=e.dFdy().normalize(),i=t,a=r.cross(i),c=i.cross(o),u=o.dot(a).mul(en),l=u.sign().mul(s.x.mul(a).add(s.y.mul(c)));return u.abs().mul(t).sub(l).normalize()});class sc extends H{constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Of({textureNode:this.textureNode,bumpScale:e});return Df({surf_pos:ye,surf_norm:Tt,dHdxy:t})}}const _f=g(sc);f("bumpMap",_f);w("BumpMapNode",sc);const kf=E(({color:n,adjustment:e})=>e.mix(We(n.rgb),n.rgb)),Vf=E(({color:n,adjustment:e})=>{const t=Re(n.r,n.g,n.b).div(3),s=n.r.max(n.g.max(n.b)),o=s.sub(t).mul(e).mul(-3);return re(n.rgb,s,o)}),zf=E(({color:n,adjustment:e})=>{const t=N(.57735,.57735,.57735),s=e.cos();return N(n.rgb.mul(s).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(hn(t,n.rgb).mul(s.oneMinus())))))});class Ae extends H{constructor(e,t,s=T(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,o={color:t,adjustment:s};let r=null;return e===Ae.SATURATION?r=kf(o):e===Ae.VIBRANCE?r=Vf(o):e===Ae.HUE?r=zf(o):console.error(`${this.type}: Method "${this.method}" not supported!`),r}}Ae.SATURATION="saturation";Ae.VIBRANCE="vibrance";Ae.HUE="hue";const Ff=g(Ae,Ae.SATURATION),Uf=g(Ae,Ae.VIBRANCE),Pf=g(Ae,Ae.HUE),Bf=N(.2125,.7154,.0721),We=(n,e=Bf)=>hn(n,e),nc=(n,e)=>re(N(0),n,We(n).sub(e).max(0));f("saturation",Ff);f("vibrance",Uf);f("hue",Pf);f("threshold",nc);w("ColorAdjustmentNode",Ae);const Wf=E(n=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:o}=n,r=e.dFdx(),i=e.dFdy(),a=o.dFdx(),c=o.dFdy(),u=t,l=i.cross(u),h=u.cross(r),d=l.mul(a.x).add(h.mul(c.x)),m=l.mul(a.y).add(h.mul(c.y)),y=d.dot(d).max(m.dot(m)),x=en.mul(y.inverseSqrt());return Re(d.mul(s.x,x),m.mul(s.y,x),u.mul(s.z)).normalize()});class oc extends H{constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=qo}setup(e){const{normalMapType:t,scaleNode:s}=this;let o=this.node.mul(2).sub(1);s!==null&&(o=N(o.xy.mul(s),o.z));let r=null;return t===tu?r=sa.mul(o).normalize():t===qo&&(e.hasGeometryAttribute("tangent")===!0?r=Pt.mul(o).normalize():r=Wf({eye_pos:ye,surf_norm:Tt,mapN:o,uv:Le()})),r}}const Gf=g(oc);f("normalMap",Gf);w("NormalMapNode",oc);class rc extends H{constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Yf=g(rc);f("posterize",Yf);w("PosterizeNode",rc);const Hf=E(({color:n,exposure:e})=>n.mul(e).clamp()),$f=E(({color:n,exposure:e})=>(n=n.mul(e),n.div(n.add(1)).clamp())),qf=E(({color:n,exposure:e})=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),jf=E(({color:n})=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),Kf=E(({color:n,exposure:e})=>{const t=ve(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=ve(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=jf({color:n}),n=s.mul(n),n.clamp()}),Xf=ve(N(1.6605,-.1246,-.0182),N(-.5876,1.1329,-.1006),N(-.0728,-.0083,1.1187)),Zf=ve(N(.6274,.0691,.0164),N(.3293,.9195,.088),N(.0433,.0113,.8956)),Jf=E(([n])=>{const e=N(n).toVar(),t=N(e.mul(e)).toVar(),s=N(t.mul(t)).toVar();return T(15.5).mul(s.mul(t)).sub(q(40.14,s.mul(e))).add(q(31.96,s).sub(q(6.868,t.mul(e))).add(q(.4298,t).add(q(.1191,e).sub(.00232))))}),Qf=E(({color:n,exposure:e})=>{const t=N(n).toVar(),s=ve(N(.856627153315983,.137318972929847,.11189821299995),N(.0951212405381588,.761241990602591,.0767994186031903),N(.0482516061458583,.101439036467562,.811302368396859)),o=ve(N(1.1271005818144368,-.1413297634984383,-.14132976349843826),N(-.11060664309660323,1.157823702216272,-.11060664309660294),N(-.016493938717834573,-.016493938717834257,1.2519364065950405)),r=T(-12.47393),i=T(4.026069);return t.mulAssign(e),t.assign(Zf.mul(t)),t.assign(s.mul(t)),t.assign(be(t,1e-10)),t.assign(un(t)),t.assign(t.sub(r).div(i.sub(r))),t.assign(At(t,0,1)),t.assign(Jf(t)),t.assign(o.mul(t)),t.assign(lt(be(N(0),t),N(2.2))),t.assign(Xf.mul(t)),t.assign(At(t,0,1)),t}),em=E(({color:n,exposure:e})=>{const t=T(.76),s=T(.15);n=n.mul(e);const o=ut(n.r,ut(n.g,n.b)),r=Fe(o.lessThan(.08),o.sub(q(6.25,o.mul(o))),.04);n.subAssign(r);const i=be(n.r,be(n.g,n.b));se(i.lessThan(t),()=>n);const a=tt(1,t),c=tt(1,a.mul(a).div(i.add(a.sub(t))));n.mulAssign(c.div(i));const u=tt(1,ht(1,s.mul(i.sub(c)).add(1)));return re(n,N(c),u)}).setLayout({name:"NeutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),tm={[su]:Hf,[nu]:$f,[ou]:qf,[ru]:Kf,[iu]:Qf,[au]:em};class ic extends H{constructor(e=fs,t=nm,s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===fs)return t;const o={exposure:this.exposureNode,color:t},r=tm[s];let i=null;return r?i=r(o):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),i=t),i}}const sm=(n,e,t)=>M(new ic(n,M(e),M(t))),nm=yf("toneMappingExposure","float");f("toneMapping",(n,e,t)=>sm(e,t,n));w("ToneMappingNode",ic);let Dn=null;class ac extends Ss{constructor(e=Ts,t=null){Dn===null&&(Dn=new ri),super(e,t,Dn)}updateReference(){return this}}const om=g(ac);f("viewportSharedTexture",om);w("ViewportSharedTextureNode",ac);const rm=new Ne;class ho extends It{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Ms extends H{constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new No;o.isRenderTargetTexture=!0,o.name="PostProcessingDepth";const r=new vt(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:cu});r.texture.name="PostProcessing",r.depthTexture=o,this.renderTarget=r,this.updateBeforeType=W.FRAME,this._textureNode=M(new ho(this,r.texture)),this._depthTextureNode=M(new ho(this,o)),this._linearDepthNode=null,this._viewZNode=null,this._cameraNear=k(0),this._cameraFar=k(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getViewZNode(){if(this._viewZNode===null){const e=this._cameraNear,t=this._cameraFar;this._viewZNode=Ra(this._depthTextureNode,e,t)}return this._viewZNode}getLinearDepthNode(){if(this._linearDepthNode===null){const e=this._cameraNear,t=this._cameraFar;this._linearDepthNode=Fs(this.getViewZNode(),e,t)}return this._linearDepthNode}setup(){return this.scope===Ms.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:o}=this;this._pixelRatio=t.getPixelRatio();const r=t.getSize(rm);this.setSize(r.width,r.height);const i=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=o.near,this._cameraFar.value=o.far,t.toneMapping=fs,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,o),t.toneMapping=i,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget.setSize(s,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Ms.COLOR="color";Ms.DEPTH="depth";const yn=(n,e)=>M(new ho(n,e));w("PassNode",Ms);const _n=new uu(-1,1,1,-1,0,1);class im extends du{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new jo([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new jo(t,2))}}const am=new im;class Es extends lu{constructor(e=null){super(am,e),this.camera=_n}renderAsync(e){return e.renderAsync(this,_n)}render(e){e.render(this,_n)}}const Wr=new Es,Gr=new Es;class cm extends H{constructor(e,t=2){super("vec4"),this.textureNode=e,this.sigma=t,this.directionNode=b(1),this._invSize=k(new Ne),this._passDirection=k(new Ne),this._horizontalRT=new vt,this._horizontalRT.texture.name="GaussianBlurNode.horizontal",this._verticalRT=new vt,this._verticalRT.texture.name="GaussianBlurNode.vertical",this._textureNode=yn(this,this._verticalRT.texture),this.updateBeforeType=W.RENDER,this.resolution=new Ne(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,o=s.value,r=t.getRenderTarget(),i=s.value;Wr.material=this._material,Gr.material=this._material,this.setSize(o.image.width,o.image.height);const a=o.type;this._horizontalRT.texture.type=a,this._verticalRT.texture.type=a,t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),Wr.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),Gr.render(t),t.setRenderTarget(r),s.value=i}getTextureNode(){return this._textureNode}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),L();const s=t.uvNode||Le(),o=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),r=E(()=>{const c=3+2*this.sigma,u=this._getCoefficients(c),l=this._invSize,h=b(this.directionNode).mul(this._passDirection),d=T(u[0]).toVar(),m=L(o(s).mul(d)).toVar();for(let y=1;y<c;y++){const x=T(y),S=T(u[y]),R=b(h.mul(l.mul(x))).toVar(),O=L(o(s.add(R))),I=L(o(s.sub(R)));m.addAssign(O.add(I).mul(S)),d.addAssign(q(2,S))}return m.div(d)}),i=this._material||(this._material=e.createNodeMaterial());i.fragmentNode=r();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const um=(n,e)=>M(new cm(M(n),e));f("gaussianBlur",um);const kn=new Ne,Yr=new Es;class lm extends H{constructor(e,t=.96){super(e),this.textureNode=e,this.textureNodeOld=de(),this.damp=k(t),this._compRT=new vt,this._compRT.texture.name="AfterImageNode.comp",this._oldRT=new vt,this._oldRT.texture.name="AfterImageNode.old",this._textureNode=yn(this,this._compRT.texture),this.updateBeforeType=W.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._compRT.setSize(e,t),this._oldRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,r=s.value.type;this._compRT.texture.type=r,this._oldRT.texture.type=r,t.getDrawingBufferSize(kn),this.setSize(kn.x,kn.y);const i=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget(),u=s.value;this.textureNodeOld.value=this._oldRT.texture,t.toneMapping=fs,t.toneMappingNode=null,t.setRenderTarget(this._compRT),Yr.render(t);const l=this._oldRT;this._oldRT=this._compRT,this._compRT=l,t.toneMapping=i,t.toneMappingNode=a,t.setRenderTarget(c),s.value=u}setup(e){const t=this.textureNode,s=this.textureNodeOld;if(t.isTextureNode!==!0)return console.error("AfterImageNode requires a TextureNode."),L();const o=t.uvNode||Le();s.uvNode=o;const r=l=>t.cache().context({getUV:()=>l,forceUVContext:!0}),i=E(([l,h])=>{const d=T(h).toVar(),m=L(l).toVar();return be(Vo(m.sub(d)),0)}),a=E(()=>{const l=L(s),h=L(r(o));return l.mulAssign(this.damp.mul(i(l,.1))),be(h,l)}),c=this._materialComposed||(this._materialComposed=e.createNodeMaterial());c.fragmentNode=a(),Yr.material=c;const u=e.getNodeProperties(this);return u.textureNode=t,this._textureNode}}const dm=(n,e)=>M(new lm(M(n),e));f("afterImage",dm);const Hr=new Es;class hm extends H{constructor(e,t,s,o){super("vec4"),this.textureNode=e,this.tresholdNode=t,this.scaleNode=s,this.colorNode=N(.1,0,1),this.samples=o,this.resolution=new Ne(1,1),this._renderTarget=new vt,this._renderTarget.texture.name="anamorphic",this._invSize=k(new Ne),this._textureNode=yn(this,this._renderTarget.texture),this.updateBeforeType=W.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._invSize.value.set(1/e,1/t),e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,o=s.value;this._renderTarget.texture.type=o.type;const r=t.getRenderTarget(),i=s.value;Hr.material=this._material,this.setSize(o.image.width,o.image.height),t.setRenderTarget(this._renderTarget),Hr.render(t),t.setRenderTarget(r),s.value=i}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("AnamorphNode requires a TextureNode."),L();const s=t.uvNode||Le(),o=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),r=E(()=>{const c=this.samples,u=Math.floor(c/2),l=N(0).toVar();return Ye({start:-u,end:u},({i:h})=>{const d=T(h).abs().div(u).oneMinus(),m=b(s.x.add(this._invSize.x.mul(h).mul(this.scaleNode)),s.y),y=o(m),x=nc(y,this.tresholdNode).mul(d);l.addAssign(x)}),l.mul(this.colorNode)}),i=this._material||(this._material=e.createNodeMaterial());i.fragmentNode=r();const a=e.getNodeProperties(this);return a.textureNode=t,this._textureNode}}const pm=(n,e=.9,t=3,s=32)=>M(new hm(M(n),M(e),M(t),s));f("anamorphic",pm);class fm extends H{constructor(e){super(),this.textureNode=e,this.updateBeforeType=W.RENDER,this._invSize=k(new Ne)}updateBefore(){const e=this.textureNode.value;this._invSize.value.set(1/e.image.width,1/e.image.height)}setup(){const{textureNode:e}=this,t=e.uvNode||Le(),s=i=>this.textureNode.cache().context({getUV:()=>i,forceUVContext:!0});return E(()=>{const i=this._invSize,a=ve(-1,-2,-1,0,0,0,1,2,1),c=ve(-1,0,1,-2,0,2,-1,0,1),u=We(s(t.add(i.mul(b(-1,-1)))).xyz),l=We(s(t.add(i.mul(b(-1,0)))).xyz),h=We(s(t.add(i.mul(b(-1,1)))).xyz),d=We(s(t.add(i.mul(b(0,-1)))).xyz),m=We(s(t.add(i.mul(b(0,0)))).xyz),y=We(s(t.add(i.mul(b(0,1)))).xyz),x=We(s(t.add(i.mul(b(1,-1)))).xyz),S=We(s(t.add(i.mul(b(1,0)))).xyz),R=We(s(t.add(i.mul(b(1,1)))).xyz),O=Re(a[0][0].mul(u),a[1][0].mul(d),a[2][0].mul(x),a[0][1].mul(l),a[1][1].mul(m),a[2][1].mul(S),a[0][2].mul(h),a[1][2].mul(y),a[2][2].mul(R)),I=Re(c[0][0].mul(u),c[1][0].mul(d),c[2][0].mul(x),c[0][1].mul(l),c[1][1].mul(m),c[2][1].mul(S),c[0][2].mul(h),c[1][2].mul(y),c[2][2].mul(R)),j=O.mul(O).add(I.mul(I)).sqrt();return L(N(j),1)})()}}const mm=n=>M(new fm(M(n)));f("sobel",mm);class gm extends H{constructor(e,t,s=1,o=.025,r=1){super(),this.textureNode=e,this.viewZNode=t,this.focus=k(s),this.aperture=k(o),this.maxblur=k(r),this._aspect=k(0),this.updateBeforeType=W.RENDER}updateBefore(){const e=this.textureNode.value;this._aspect.value=e.image.width/e.image.height}setup(){const{textureNode:e}=this,t=e.uvNode||Le(),s=i=>this.textureNode.uv(i);return E(()=>{const i=b(1,this._aspect),a=this.focus.add(this.viewZNode),c=b(At(a.mul(this.aperture),this.maxblur.negate(),this.maxblur)),u=c.mul(.9),l=c.mul(.7),h=c.mul(.4);let d=L(0);return d=d.add(s(t)),d=d.add(s(t.add(b(0,.4).mul(i).mul(c)))),d=d.add(s(t.add(b(.15,.37).mul(i).mul(c)))),d=d.add(s(t.add(b(.29,.29).mul(i).mul(c)))),d=d.add(s(t.add(b(-.37,.15).mul(i).mul(c)))),d=d.add(s(t.add(b(.4,0).mul(i).mul(c)))),d=d.add(s(t.add(b(.37,-.15).mul(i).mul(c)))),d=d.add(s(t.add(b(.29,-.29).mul(i).mul(c)))),d=d.add(s(t.add(b(-.15,-.37).mul(i).mul(c)))),d=d.add(s(t.add(b(0,-.4).mul(i).mul(c)))),d=d.add(s(t.add(b(-.15,.37).mul(i).mul(c)))),d=d.add(s(t.add(b(-.29,.29).mul(i).mul(c)))),d=d.add(s(t.add(b(.37,.15).mul(i).mul(c)))),d=d.add(s(t.add(b(-.4,0).mul(i).mul(c)))),d=d.add(s(t.add(b(-.37,-.15).mul(i).mul(c)))),d=d.add(s(t.add(b(-.29,-.29).mul(i).mul(c)))),d=d.add(s(t.add(b(.15,-.37).mul(i).mul(c)))),d=d.add(s(t.add(b(.15,.37).mul(i).mul(u)))),d=d.add(s(t.add(b(-.37,.15).mul(i).mul(u)))),d=d.add(s(t.add(b(.37,-.15).mul(i).mul(u)))),d=d.add(s(t.add(b(-.15,-.37).mul(i).mul(u)))),d=d.add(s(t.add(b(-.15,.37).mul(i).mul(u)))),d=d.add(s(t.add(b(.37,.15).mul(i).mul(u)))),d=d.add(s(t.add(b(-.37,-.15).mul(i).mul(u)))),d=d.add(s(t.add(b(.15,-.37).mul(i).mul(u)))),d=d.add(s(t.add(b(.29,.29).mul(i).mul(l)))),d=d.add(s(t.add(b(.4,0).mul(i).mul(l)))),d=d.add(s(t.add(b(.29,-.29).mul(i).mul(l)))),d=d.add(s(t.add(b(0,-.4).mul(i).mul(l)))),d=d.add(s(t.add(b(-.29,.29).mul(i).mul(l)))),d=d.add(s(t.add(b(-.4,0).mul(i).mul(l)))),d=d.add(s(t.add(b(-.29,-.29).mul(i).mul(l)))),d=d.add(s(t.add(b(0,.4).mul(i).mul(l)))),d=d.add(s(t.add(b(.29,.29).mul(i).mul(h)))),d=d.add(s(t.add(b(.4,0).mul(i).mul(h)))),d=d.add(s(t.add(b(.29,-.29).mul(i).mul(h)))),d=d.add(s(t.add(b(0,-.4).mul(i).mul(h)))),d=d.add(s(t.add(b(-.29,.29).mul(i).mul(h)))),d=d.add(s(t.add(b(-.4,0).mul(i).mul(h)))),d=d.add(s(t.add(b(-.29,-.29).mul(i).mul(h)))),d=d.add(s(t.add(b(0,.4).mul(i).mul(h)))),d=d.div(41),d.a=1,L(d)})()}}const ym=(n,e,t,s,o)=>M(new gm(M(n),M(e),t,s,o));f("dof",ym);const $r=new Es;class Nm extends H{constructor(e,t=new Ne(.5,.5),s=1.57,o=1){super("vec4"),this.colorNode=e,this.center=k(t),this.angle=k(s),this.scale=k(o),this._renderTarget=new vt,this._renderTarget.texture.name="dotScreen",this._size=k(new Ne),this._textureNode=yn(this,this._renderTarget.texture),this.updateBeforeType=W.RENDER}getTextureNode(){return this._textureNode}setSize(e,t){this._size.value.set(e,t),this._renderTarget.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.colorNode,o=s.value;this._renderTarget.texture.type=o.type;const r=t.getRenderTarget(),i=s.value;$r.material=this._material,this.setSize(o.image.width,o.image.height),t.setRenderTarget(this._renderTarget),$r.render(t),t.setRenderTarget(r),s.value=i}setup(e){const t=this.colorNode,s=E(()=>{const a=_e(this.angle),c=Ze(this.angle),u=Le().mul(this._size).sub(this.center),l=b(c.mul(u.x).sub(a.mul(u.y)),a.mul(u.x).add(c.mul(u.y))).mul(this.scale);return _e(l.x).mul(_e(l.y)).mul(4)}),o=E(()=>{const a=t,c=Re(a.r,a.g,a.b).div(3);return L(N(c.mul(10).sub(5).add(s())),a.a)}),r=this._material||(this._material=e.createNodeMaterial());r.fragmentNode=o();const i=e.getNodeProperties(this);return i.textureNode=t,this._textureNode}}const vm=(n,e,t,s)=>M(new Nm(M(n),e,t,s));f("dotScreen",vm);class Tm extends H{constructor(e,t=.005,s=0){super("vec4"),this.textureNode=e,this.amount=k(t),this.angle=k(s),this.updateBeforeType=W.RENDER}updateBefore(){}setup(){const{textureNode:e}=this,t=e.uvNode||Le(),s=r=>this.textureNode.uv(r);return E(()=>{const r=b(Ze(this.angle),_e(this.angle)).mul(this.amount),i=s(t.add(r)),a=s(t),c=s(t.sub(r));return L(i.r,a.g,c.b,a.a)})()}}const xm=(n,e,t)=>M(new Tm(M(n),e,t));f("rgbShift",xm);class cc extends H{constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,o=s.getInputs(e),r=this.parameters;if(Array.isArray(r))for(let a=0;a<r.length;a++){const c=o[a],u=r[a];t.push(u.build(e,c.type))}else for(const a of o){const c=r[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const wm=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Gt(e):an(e[0]),M(new cc(M(n),e)));f("call",wm);w("FunctionCallNode",cc);class uc extends D{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new ei,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:T()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=wi(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=bi(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const Us=g(uc);f("scriptableValue",Us);w("ScriptableValueNode",uc);class lc extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const o=t(...s);return this.set(e,o),o}}}class bm{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const Vn=new lc;class dc extends D{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new lc,this._output=Us(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=Us(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=Us(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o(...t)}async callAsync(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o.constructor.name==="AsyncFunction"?await o(...t):o(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,l)=>this.setOutput(u,l),s=new bm(this),o=Vn.get("THREE"),r=Vn.get("TSL"),i=this.getMethod(this.codeNode),a=[s,this._local,Vn,e,t,o,r];this._object=i(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const u of c.elements){const l=u.id||u.name;u.inputType&&(this.getParameter(l)===void 0&&this.setParameter(l,null),this.getParameter(l).inputType=u.inputType),u.outputType&&(this.getOutput(l)===void 0&&this.setOutput(l,null),this.getOutput(l).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:T()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),o="var "+s+`; var output = {};
`,r=`
return { ...output, `+s+" };",i=o+this.codeNode.code+r;return this._method=new Function(...e,i),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Sm=g(dc);f("scriptable",Sm);w("ScriptableNode",dc);class Nn extends D{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}getViewZNode(e){let t;const s=e.context.getViewZ;return s!==void 0&&(t=s(this)),(t||ye.z).negate()}setup(){return this.factorNode}}const Mm=g(Nn);f("fog",Mm);w("FogNode",Nn);class hc extends Nn{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(e){const t=this.getViewZNode(e);return st(this.nearNode,this.farNode,t)}}const Em=g(hc);f("rangeFog",Em);w("FogRangeNode",hc);class pc extends Nn{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(e){const t=this.getViewZNode(e),s=this.densityNode;return s.mul(s,t,t).negate().exp().oneMinus()}}const Am=g(pc);f("densityFog",Am);w("FogExp2Node",pc);let bt=null,St=null;class fc extends D{constructor(e=T(),t=T()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(yt(this.minNode.value)),s=e.getTypeLength(yt(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.count>1){const o=this.minNode.value,r=this.maxNode.value,i=e.getTypeLength(yt(o)),a=e.getTypeLength(yt(r));bt=bt||new Nt,St=St||new Nt,bt.setScalar(0),St.setScalar(0),i===1?bt.setScalar(o):o.isColor?bt.set(o.r,o.g,o.b):bt.set(o.x,o.y,o.z||0,o.w||0),a===1?St.setScalar(r):r.isColor?St.set(r.r,r.g,r.b):St.set(r.x,r.y,r.z||0,r.w||0);const c=4,u=c*t.count,l=new Float32Array(u);for(let d=0;d<u;d++){const m=d%c,y=bt.getComponent(m),x=St.getComponent(m);l[d]=ti.lerp(y,x,Math.random())}const h=this.getNodeType(e);if(t.count<=4096)s=zo(l,"vec4",t.count).element(Lo).convert(h);else{const d=new si(l,4);e.geometry.setAttribute("__range"+this.id,d),s=no(d).convert(h)}}else s=T(0);return s}}g(fc);w("RangeNode",fc);class mc extends D{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=W.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let o=1;o<t.length;o++)s*=t[o];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Rm=(n,e,t)=>M(new mc(M(n),e,t));f("compute",Rm);w("ComputeNode",mc);class Ct extends D{constructor(e=Ct.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===Ct.TARGET_DIRECTION&&(s=ts.transformDirection(eo(t).sub(eo(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}Ct.TARGET_DIRECTION="targetDirection";const gc=g(Ct,Ct.TARGET_DIRECTION);w("LightNode",Ct);const yc=E(n=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=n,o=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(o.mul(e.div(t).pow4().oneMinus().clamp().pow2()),o)});class Nc extends wt{constructor(e=null){super(e),this.cutoffDistanceNode=k(0),this.decayExponentNode=k(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:o,light:r}=this,i=e.context.lightingModel,a=Fo(r).sub(ye),c=a.normalize(),u=a.length(),l=yc({lightDistance:u,cutoffDistance:s,decayExponent:o}),h=t.mul(l),d=e.context.reflectedLight;i.direct({lightDirection:c,lightColor:h,reflectedLight:d,shadowMask:this.shadowMaskNode},e.stack,e)}}w("PointLightNode",Nc);Dt(hu,Nc);class vc extends wt{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,o=gc(this.light),r=e.context.reflectedLight;t.direct({lightDirection:o,lightColor:s,reflectedLight:r,shadowMask:this.shadowMaskNode},e.stack,e)}}w("DirectionalLightNode",vc);Dt(pu,vc);const zn=new ws,Os=new ws;let Ds,Fn;class Tc extends wt{constructor(e=null){super(e),this.halfHeight=k(new Se),this.halfWidth=k(new Se)}update(e){super.update(e);const{light:t}=this,s=e.camera.matrixWorldInverse;Os.identity(),zn.copy(t.matrixWorld),zn.premultiply(s),Os.extractRotation(zn),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(Os),this.halfHeight.value.applyMatrix4(Os)}setup(e){super.setup(e),Ds===void 0&&(e.isAvailable("float32Filterable")?(Ds=de(Rs.LTC_FLOAT_1),Fn=de(Rs.LTC_FLOAT_2)):(Ds=de(Rs.LTC_HALF_1),Fn=de(Rs.LTC_HALF_2)));const{colorNode:t,light:s}=this,o=e.context.lightingModel,r=Fo(s),i=e.context.reflectedLight;o.directRectArea({lightColor:t,lightPosition:r,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:i,ltc_1:Ds,ltc_2:Fn},e.stack,e)}}w("RectAreaLightNode",Tc);Dt(fu,Tc);class Wo extends wt{constructor(e=null){super(e),this.coneCosNode=k(0),this.penumbraCosNode=k(0),this.cutoffDistanceNode=k(0),this.decayExponentNode=k(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return st(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:o,decayExponentNode:r,light:i}=this,a=Fo(i).sub(ye),c=a.normalize(),u=c.dot(gc(i)),l=this.getSpotAttenuation(u),h=a.length(),d=yc({lightDistance:h,cutoffDistance:o,decayExponent:r}),m=s.mul(l).mul(d),y=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:m,reflectedLight:y,shadowMask:this.shadowMaskNode},e.stack,e)}}w("SpotLightNode",Wo);Dt(ii,Wo);class Cm extends ii{constructor(e,t,s,o,r,i){super(e,t,s,o,r,i),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class xc extends Wo{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const o=e.acos().mul(1/Math.PI);s=de(t,b(o,0),0).r}else s=super.getSpotAttenuation(e);return s}}w("IESSpotLightNode",xc);Dt(Cm,xc);class wc extends wt{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}w("AmbientLightNode",wc);Dt(mu,wc);class bc extends wt{constructor(e=null){super(e),this.lightPositionNode=eo(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=k(new go)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:o}=this,i=Tt.dot(o).mul(.5).add(.5),a=re(s,t,i);e.context.irradiance.addAssign(a)}}w("HemisphereLightNode",bc);Dt(gu,bc);const Lm=E(n=>{const e=n.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class Sc extends H{constructor(e=Le()){super("float"),this.uvNode=e}setup(){return Lm({uv:this.uvNode})}}const Im=g(Sc);f("checker",Im);w("CheckerNode",Sc);const Om=new ai;class Dm extends Te{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(Om),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=E(()=>{oe(b(),"vUv").assign(Le());const s=ge("instancePosition"),o=ee("vec4","mvPos");o.assign(Rt.mul(L(s,1)));const r=jt.z.div(jt.w),i=Qe.mul(o),a=ee("vec2","offset");return a.assign(xe.xy),a.assign(a.mul(vp)),a.assign(a.div(jt.z)),a.y.assign(a.y.mul(r)),a.assign(a.mul(i.w)),i.assign(i.add(L(a,0,0))),i})(),this.fragmentNode=E(()=>{const s=oe(b(),"vUv"),o=ee("float","alpha");o.assign(1);const r=s.x,i=s.y,a=r.mul(r).add(i.mul(i));if(e){const u=ee("float","dlen");u.assign(a.fwidth()),o.assign(st(u.oneMinus(),u.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=ge("instanceColor").mul(vs):c=vs,L(c,o)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}le("InstancedPointsNodeMaterial",Dm);const _m=new yu;class km extends Te{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(_m),this.setValues(e)}}le("LineBasicNodeMaterial",km);const Vm=new ci;class zm extends Te{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Vm),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?T(this.dashScaleNode):to,s=this.dashSizeNode?T(this.dashSizeNode):ra,o=this.dashSizeNode?T(this.dashGapNode):ia;$t.assign(s),Ks.assign(o);const r=oe(ge("lineDistance").mul(t));(e?r.add(e):r).mod($t.add(Ks)).greaterThan($t).discard()}}le("LineDashedNodeMaterial",zm);const Fm=new ci;class Um extends Te{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(Fm),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setup(e){this.setupShaders(),super.setup(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,o=this.worldUnits,r=E(({start:a,end:c})=>{const u=Qe.element(2).element(2),d=Qe.element(3).element(2).mul(-.5).div(u).sub(a.z).div(c.z.sub(a.z));return L(re(a.xyz,c.xyz,d),c.w)});this.vertexNode=E(()=>{Ke("vec2","vUv").assign(Le());const a=ge("instanceStart"),c=ge("instanceEnd"),u=ee("vec4","start"),l=ee("vec4","end");u.assign(Rt.mul(L(a,1))),l.assign(Rt.mul(L(c,1))),o&&(Ke("vec3","worldStart").assign(u.xyz),Ke("vec3","worldEnd").assign(l.xyz));const h=jt.z.div(jt.w),d=Qe.element(2).element(3).equal(-1);se(d,()=>{se(u.z.lessThan(0).and(l.z.greaterThan(0)),()=>{l.assign(r({start:u,end:l}))}).elseif(l.z.lessThan(0).and(u.z.greaterThanEqual(0)),()=>{u.assign(r({start:l,end:u}))})});const m=Qe.mul(u),y=Qe.mul(l),x=m.xyz.div(m.w),S=y.xyz.div(y.w),R=S.xy.sub(x.xy).temp();R.x.assign(R.x.mul(h)),R.assign(R.normalize());const O=Hs(L());if(o){const I=l.xyz.sub(u.xyz).normalize(),j=re(u.xyz,l.xyz,.5).normalize(),U=I.cross(j).normalize(),z=I.cross(U),G=Ke("vec4","worldPos");G.assign(xe.y.lessThan(.5).cond(u,l));const F=wn.mul(.5);G.addAssign(L(xe.x.lessThan(0).cond(U.mul(F),U.mul(F).negate()),0)),s||(G.addAssign(L(xe.y.lessThan(.5).cond(I.mul(F).negate(),I.mul(F)),0)),G.addAssign(L(z.mul(F),0)),se(xe.y.greaterThan(1).or(xe.y.lessThan(0)),()=>{G.subAssign(L(z.mul(2).mul(F),0))})),O.assign(Qe.mul(G));const Pe=Hs(N());Pe.assign(xe.y.lessThan(.5).cond(x,S)),O.z.assign(Pe.z.mul(O.w))}else{const I=ee("vec2","offset");I.assign(b(R.y,R.x.negate())),R.x.assign(R.x.div(h)),I.x.assign(I.x.div(h)),I.assign(xe.x.lessThan(0).cond(I.negate(),I)),se(xe.y.lessThan(0),()=>{I.assign(I.sub(R))}).elseif(xe.y.greaterThan(1),()=>{I.assign(I.add(R))}),I.assign(I.mul(wn)),I.assign(I.div(jt.w)),O.assign(xe.y.lessThan(.5).cond(m,y)),I.assign(I.mul(O.w)),O.assign(O.add(L(I,0,0)))}return O})();const i=E(({p1:a,p2:c,p3:u,p4:l})=>{const h=a.sub(u),d=l.sub(u),m=c.sub(a),y=h.dot(d),x=d.dot(m),S=h.dot(m),R=d.dot(d),I=m.dot(m).mul(R).sub(x.mul(x)),U=y.mul(x).sub(S.mul(R)).div(I).clamp(),z=y.add(x.mul(U)).div(R).clamp();return b(U,z)});this.fragmentNode=E(()=>{const a=Ke("vec2","vUv");if(s){const l=this.offsetNode?T(this.offsetNodeNode):Er,h=this.dashScaleNode?T(this.dashScaleNode):to,d=this.dashSizeNode?T(this.dashSizeNode):ra,m=this.dashSizeNode?T(this.dashGapNode):ia;$t.assign(d),Ks.assign(m);const y=ge("instanceDistanceStart"),x=ge("instanceDistanceEnd"),S=xe.y.lessThan(.5).cond(h.mul(y),to.mul(x)),R=oe(S.add(Er)),O=l?R.add(l):R;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),O.mod($t.add(Ks)).greaterThan($t).discard()}const c=ee("float","alpha");if(c.assign(1),o){const l=Ke("vec3","worldStart"),h=Ke("vec3","worldEnd"),d=Ke("vec4","worldPos").xyz.normalize().mul(1e5),m=h.sub(l),y=i({p1:l,p2:h,p3:N(0,0,0),p4:d}),x=l.add(m.mul(y.x)),S=d.mul(y.y),I=x.sub(S).length().div(wn);if(!s)if(e){const j=I.fwidth();c.assign(st(j.negate().add(.5),j.add(.5),I).oneMinus())}else I.greaterThan(.5).discard()}else if(e){const l=a.x,h=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),d=l.mul(l).add(h.mul(h)),m=ee("float","dlen");m.assign(d.fwidth()),se(a.y.abs().greaterThan(1),()=>{c.assign(st(m.oneMinus(),m.add(1),d).oneMinus())})}else se(a.y.abs().greaterThan(1),()=>{const l=a.x,h=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));l.mul(l).add(h.mul(h)).greaterThan(1).discard()});let u;if(this.lineColorNode)u=this.lineColorNode;else if(t){const l=ge("instanceColorStart"),h=ge("instanceColorEnd");u=xe.y.lessThan(.5).cond(l,h).mul(vs)}else u=vs;return L(u,c)})()}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.needsUpdate=!0)}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.needsUpdate=!0)}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.needsUpdate=!0)}}le("Line2NodeMaterial",Um);const Pm=new Nu;class Bm extends Te{constructor(e){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Pm),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?T(this.opacityNode):oa;X.assign(L(Wa(te),e))}}le("MeshNormalNodeMaterial",Bm);const Wm=new vu;class Gm extends Te{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(Wm),this.setValues(e)}}le("MeshBasicNodeMaterial",Gm);const xs=E(({f0:n,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(s.oneMinus()).add(e.mul(s))}),Zt=E(n=>n.diffuseColor.mul(1/Math.PI)),Ym=()=>T(.25),Hm=E(({dotNH:n})=>Xn.mul(T(.5)).add(1).mul(T(1/Math.PI)).mul(n.pow(Xn))),$m=E(({lightDirection:n})=>{const e=n.add(Q).normalize(),t=te.dot(e).clamp(),s=Q.dot(e).clamp(),o=xs({f0:De,f90:1,dotVH:s}),r=Ym(),i=Hm({dotNH:t});return o.mul(r).mul(i)});class Mc extends cn{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const r=te.dot(e).clamp().mul(t);s.directDiffuse.addAssign(r.mul(Zt({diffuseColor:X.rgb}))),this.specular===!0&&s.directSpecular.addAssign(r.mul($m({lightDirection:e})).mul(ep))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Zt({diffuseColor:X})))}}const qm=new Tu;class jm extends Te{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(qm),this.setValues(e)}setupLightingModel(){return new Mc(!1)}}le("MeshLambertNodeMaterial",jm);const Km=new xu;class Xm extends Te{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Km),this.setValues(e)}setupLightingModel(){return new Mc}setupVariants(){const e=(this.shininessNode?T(this.shininessNode):Xh).max(1e-4);Xn.assign(e);const t=this.specularNode||Jh;De.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}le("MeshPhongNodeMaterial",Xm);const Zm=E(()=>{const n=Zs.dFdx().abs().max(Zs.dFdy().abs());return n.x.max(n.y).max(n.z)}),Ec=E(n=>{const{roughness:e}=n,t=Zm();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),Jm=E(({alpha:n,dotNL:e,dotNV:t})=>{const s=n.pow2(),o=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt()),r=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt());return ht(.5,o.add(r).max(Bi))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Qm=E(({alphaT:n,alphaB:e,dotTV:t,dotBV:s,dotTL:o,dotBL:r,dotNV:i,dotNL:a})=>{const c=a.mul(N(n.mul(t),e.mul(s),i).length()),u=i.mul(N(n.mul(o),e.mul(r),a).length());return ht(.5,c.add(u)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),eg=E(({alpha:n,dotNH:e})=>{const t=n.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),tg=T(1/Math.PI),sg=E(({alphaT:n,alphaB:e,dotNH:t,dotTH:s,dotBH:o})=>{const r=n.mul(e),i=N(e.mul(s),n.mul(o),r.mul(t)),a=i.dot(i),c=r.div(a);return tg.mul(r.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),qr=E(n=>{const{lightDirection:e,f0:t,f90:s,roughness:o,f:r,USE_IRIDESCENCE:i,USE_ANISOTROPY:a}=n,c=n.normalView||te,u=o.pow2(),l=e.add(Q).normalize(),h=c.dot(e).clamp(),d=c.dot(Q).clamp(),m=c.dot(l).clamp(),y=Q.dot(l).clamp();let x=xs({f0:t,f90:s,dotVH:y}),S,R;if(Tr(i)&&(x=Oo.mix(x,r)),Tr(a)){const O=Vs.dot(e),I=Vs.dot(Q),j=Vs.dot(l),U=Ht.dot(e),z=Ht.dot(Q),G=Ht.dot(l);S=Qm({alphaT:Kn,alphaB:u,dotTV:I,dotBV:z,dotTL:O,dotBL:U,dotNV:d,dotNL:h}),R=sg({alphaT:Kn,alphaB:u,dotNH:m,dotTH:j,dotBH:G})}else S=Jm({alpha:u,dotNL:h,dotNV:d}),R=eg({alpha:u,dotNH:m});return x.mul(S).mul(R)}),Ac=E(({roughness:n,dotNV:e})=>{const t=L(-1,-.0275,-.572,.022),s=L(1,.0425,1.04,-.04),o=n.mul(t).add(s),r=o.x.mul(o.x).min(e.mul(-9.28).exp2()).mul(o.x).add(o.y);return b(-1.04,1.04).mul(r).add(o.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),Rc=E(n=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:o}=n,r=Ac({dotNV:e,roughness:o});return t.mul(r.x).add(s.mul(r.y))}),ng=E(({f:n,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),o=s.mul(s),r=s.mul(o,o).clamp(0,.9999);return n.sub(N(e).mul(r)).div(r.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),og=E(({roughness:n,dotNH:e})=>{const t=n.pow2(),s=T(1).div(t),r=e.pow2().oneMinus().max(.0078125);return T(2).add(s).mul(r.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),rg=E(({dotNV:n,dotNL:e})=>T(1).div(T(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),ig=E(({lightDirection:n})=>{const e=n.add(Q).normalize(),t=te.dot(n).clamp(),s=te.dot(Q).clamp(),o=te.dot(e).clamp(),r=og({roughness:Io,dotNH:o}),i=rg({dotNV:s,dotNL:t});return Ft.mul(r).mul(i)}),ag=E(({N:n,V:e,roughness:t})=>{const r=.0078125,i=n.dot(e).saturate(),a=b(t,i.oneMinus().sqrt());return a.assign(a.mul(.984375).add(r)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),cg=E(({f:n})=>{const e=n.length();return be(e.mul(e).add(n.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),_s=E(({v1:n,v2:e})=>{const t=n.dot(e),s=t.abs().toVar(),o=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),r=s.add(4.1616724).mul(s).add(3.417594).toVar(),i=o.div(r),a=t.greaterThan(0).cond(i,be(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(i));return n.cross(e).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),jr=E(({N:n,V:e,P:t,mInv:s,p0:o,p1:r,p2:i,p3:a})=>{const c=r.sub(o).toVar(),u=a.sub(o).toVar(),l=c.cross(u),h=N().toVar();return se(l.dot(t.sub(o)).greaterThanEqual(0),()=>{const d=e.sub(n.mul(e.dot(n))).normalize(),m=n.cross(d).negate(),y=s.mul(ve(d,m,n).transpose()).toVar(),x=y.mul(o.sub(t)).normalize().toVar(),S=y.mul(r.sub(t)).normalize().toVar(),R=y.mul(i.sub(t)).normalize().toVar(),O=y.mul(a.sub(t)).normalize().toVar(),I=N(0).toVar();I.addAssign(_s({v1:x,v2:S})),I.addAssign(_s({v1:S,v2:R})),I.addAssign(_s({v1:R,v2:O})),I.addAssign(_s({v1:O,v2:x})),h.assign(N(cg({f:I})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Kr=E(([n,e,t,s,o])=>{const r=N(ji(e.negate(),ys(n),ht(1,s))),i=N(qt(o[0].xyz),qt(o[1].xyz),qt(o[2].xyz));return ys(r).mul(t.mul(i))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),ug=E(([n,e])=>n.mul(At(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),lg=Ma(),Xr=E(([n,e,t])=>{const s=lg.uv(n),o=un(T(io.x)).mul(ug(e,t));return s.bicubic(o)}),Zr=E(([n,e,t])=>(se(t.notEqual(0),()=>{const s=Yi(e).negate().div(t);return Gi(s.negate().mul(n))}),N(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),dg=E(([n,e,t,s,o,r,i,a,c,u,l,h,d,m,y])=>{let x,S;if(y){x=L().toVar(),S=N().toVar();const U=l.sub(1).mul(y.mul(.025)),z=N(l.sub(U),l,l.add(U));Ye({start:0,end:3},({i:G})=>{const F=z.element(G),Pe=Kr(n,e,h,F,a),Be=i.add(Pe),As=u.mul(c.mul(L(Be,1))),_t=b(As.xy.div(As.w)).toVar();_t.addAssign(1),_t.divAssign(2),_t.assign(b(_t.x,_t.y.oneMinus()));const Yo=Xr(_t,t,F);x.element(G).assign(Yo.element(G)),x.a.addAssign(Yo.a),S.element(G).assign(s.element(G).mul(Zr(qt(Pe),d,m).element(G)))}),x.a.divAssign(3)}else{const U=Kr(n,e,h,l,a),z=i.add(U),G=u.mul(c.mul(L(z,1))),F=b(G.xy.div(G.w)).toVar();F.addAssign(1),F.divAssign(2),F.assign(b(F.x,F.y.oneMinus())),x=Xr(F,t,l),S=s.mul(Zr(qt(U),d,m))}const R=S.rgb.mul(x.rgb),O=n.dot(e).clamp(),I=N(Rc({dotNV:O,specularColor:o,specularF90:r,roughness:t})),j=S.r.add(S.g,S.b).div(3);return L(I.oneMinus().mul(R),x.a.oneMinus().mul(j).oneMinus())}),hg=ve(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),pg=n=>{const e=n.sqrt();return N(1).add(e).div(N(1).sub(e))},Jr=(n,e)=>n.sub(e).div(n.add(e)).pow2(),fg=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),s=N(54856e-17,44201e-17,52481e-17),o=N(1681e3,1795300,2208400),r=N(43278e5,93046e5,66121e5),i=T(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(r.mul(2*Math.PI).sqrt()).mul(o.mul(t).add(e).cos()).mul(t.pow2().negate().mul(r).exp());return a=N(a.x.add(i),a.y,a.z).div(10685e-11),hg.mul(a)},mg=E(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:o})=>{const r=re(n,e,st(0,.03,s)),i=n.div(r).pow2().mul(T(1).sub(t.pow2())),c=T(1).sub(i).sqrt(),u=Jr(r,n),l=xs({f0:u,f90:1,dotVH:t}),h=l.oneMinus(),d=r.lessThan(n).cond(Math.PI,0),m=T(Math.PI).sub(d),y=pg(o.clamp(0,.9999)),x=Jr(y,r.toVec3()),S=xs({f0:x,f90:1,dotVH:c}),R=N(y.x.lessThan(r).cond(Math.PI,0),y.y.lessThan(r).cond(Math.PI,0),y.z.lessThan(r).cond(Math.PI,0)),O=r.mul(s,c,2),I=N(m).add(R),j=l.mul(S).clamp(1e-5,.9999),U=j.sqrt(),z=h.pow2().mul(S).div(N(1).sub(j));let F=l.add(z),Pe=z.sub(h);for(let Be=1;Be<=2;++Be){Pe=Pe.mul(U);const As=fg(T(Be).mul(O),T(Be).mul(I)).mul(2);F=F.add(Pe.mul(As))}return F.max(N(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),gg=E(({normal:n,viewDir:e,roughness:t})=>{const s=n.dot(e).saturate(),o=t.pow2(),r=Fe(t.lessThan(.25),T(-339.2).mul(o).add(T(161.4).mul(t)).sub(25.9),T(-8.48).mul(o).add(T(14.3).mul(t)).sub(9.95)),i=Fe(t.lessThan(.25),T(44).mul(o).sub(T(23.7).mul(t)).add(3.26),T(1.97).mul(o).sub(T(3.27).mul(t)).add(.72));return Fe(t.lessThan(.25),0,T(.1).mul(t).sub(.025)).add(r.mul(s).add(i).exp()).mul(1/Math.PI).saturate()}),Un=N(.04),Pn=T(1);class Go extends cn{constructor(e=!1,t=!1,s=!1,o=!1,r=!1,i=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.anisotropy=o,this.transmission=r,this.dispersion=i,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=N().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=N().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=N().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=N().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=N().temp("sheenSpecularIndirect")),this.iridescence===!0){const t=te.dot(Q).clamp();this.iridescenceFresnel=mg({outsideIOR:T(1),eta2:_i,cosTheta1:t,thinFilmThickness:ki,baseF0:De}),this.iridescenceF0=ng({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=so,s=ta.sub(so).normalize(),o=na;e.backdrop=dg(o,s,ct,X,De,js,t,Ns,ts,Qe,zs,Vi,Fi,zi,this.dispersion?Ui:null),e.backdropAlpha=Zn,X.a.mulAssign(re(1,e.backdrop.a,Zn))}}computeMultiscattering(e,t,s){const o=te.dot(Q).clamp(),r=Ac({roughness:ct,dotNV:o}),a=(this.iridescenceF0?Oo.mix(De,this.iridescenceF0):De).mul(r.x).add(s.mul(r.y)),u=r.x.add(r.y).oneMinus(),l=De.add(De.oneMinus().mul(.047619)),h=a.mul(l).div(u.mul(l).oneMinus());e.addAssign(a),t.addAssign(h.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const r=te.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(r.mul(ig({lightDirection:e}))),this.clearcoat===!0){const a=Ut.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(qr({lightDirection:e,f0:Un,f90:Pn,roughness:qs,normalView:Ut})))}s.directDiffuse.addAssign(r.mul(Zt({diffuseColor:X.rgb}))),s.directSpecular.addAssign(r.mul(qr({lightDirection:e,f0:De,f90:1,roughness:ct,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:s,halfHeight:o,reflectedLight:r,ltc_1:i,ltc_2:a}){const c=t.add(s).sub(o),u=t.sub(s).sub(o),l=t.sub(s).add(o),h=t.add(s).add(o),d=te,m=Q,y=ye.toVar(),x=ag({N:d,V:m,roughness:ct}),S=i.uv(x).toVar(),R=a.uv(x).toVar(),O=ve(N(S.x,0,S.y),N(0,1,0),N(S.z,0,S.w)).toVar(),I=De.mul(R.x).add(De.oneMinus().mul(R.y)).toVar();r.directSpecular.addAssign(e.mul(I).mul(jr({N:d,V:m,P:y,mInv:O,p0:c,p1:u,p2:l,p3:h}))),r.directDiffuse.addAssign(e.mul(X).mul(jr({N:d,V:m,P:y,mInv:ve(1,0,0,0,1,0,0,0,1),p0:c,p1:u,p2:l,p3:h})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Zt({diffuseColor:X})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(Ft,gg({normal:te,viewDir:Q,roughness:Io}))),this.clearcoat===!0){const u=Ut.dot(Q).clamp(),l=Rc({dotNV:u,specularColor:Un,specularF90:Pn,roughness:qs});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(l))}const o=N().temp("singleScattering"),r=N().temp("multiScattering"),i=t.mul(1/Math.PI);this.computeMultiscattering(o,r,js);const a=o.add(r),c=X.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(o)),s.indirectSpecular.addAssign(r.mul(i)),s.indirectDiffuse.addAssign(c.mul(i))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const o=te.dot(Q).clamp().add(e),r=ct.mul(-16).oneMinus().negate().exp2(),i=e.sub(o.pow(r).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(i)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=Ut.dot(Q).clamp(),o=xs({dotVH:s,f0:Un,f90:Pn}),r=t.mul(jn.mul(o).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(jn));t.assign(r)}if(this.sheen===!0){const s=Ft.r.max(Ft.g).max(Ft.b).mul(.157).oneMinus(),o=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(o)}}}const yg=new wu;class Cc extends Te{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(yg),this.setValues(e)}setupLightingModel(){return new Go}setupSpecular(){const e=re(N(.04),X.rgb,$s);De.assign(e),js.assign(1)}setupVariants(){const e=this.metalnessNode?T(this.metalnessNode):sp;$s.assign(e);let t=this.roughnessNode?T(this.roughnessNode):tp;t=Ec({roughness:t}),ct.assign(t),this.setupSpecular(),X.assign(L(X.rgb.mul(e.oneMinus()),X.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}le("MeshStandardNodeMaterial",Cc);const Ng=new bu;class Lc extends Cc{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Ng),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?T(this.iorNode):gp;zs.assign(e),De.assign(re(ut(qi(zs.sub(1).div(zs.add(1))).mul(Qh),N(1)).mul(Mr),X.rgb,$s)),js.assign(re(Mr,1,$s))}setupLightingModel(){return new Go(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?T(this.clearcoatNode):op,s=this.clearcoatRoughnessNode?T(this.clearcoatRoughnessNode):rp;jn.assign(t),qs.assign(Ec({roughness:s}))}if(this.useSheen){const t=this.sheenNode?N(this.sheenNode):cp,s=this.sheenRoughnessNode?T(this.sheenRoughnessNode):up;Ft.assign(t),Io.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?T(this.iridescenceNode):dp,s=this.iridescenceIORNode?T(this.iridescenceIORNode):hp,o=this.iridescenceThicknessNode?T(this.iridescenceThicknessNode):pp;Oo.assign(t),_i.assign(s),ki.assign(o)}if(this.useAnisotropy){const t=(this.anisotropyNode?b(this.anisotropyNode):lp).toVar();Mt.assign(t.length()),se(Mt.equal(0),()=>{t.assign(b(1,0))}).else(()=>{t.divAssign(b(Mt)),Mt.assign(Mt.saturate())}),Kn.assign(Mt.pow2().mix(ct.pow2(),1)),Vs.assign(Pt[0].mul(t.x).add(Pt[1].mul(t.y))),Ht.assign(Pt[1].mul(t.x).sub(Pt[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?T(this.transmissionNode):fp,s=this.thicknessNode?T(this.thicknessNode):mp,o=this.attenuationDistanceNode?T(this.attenuationDistanceNode):yp,r=this.attenuationColorNode?N(this.attenuationColorNode):Np;if(Zn.assign(t),Vi.assign(s),zi.assign(o),Fi.assign(r),this.useDispersion){const i=this.dispersionNode?T(this.dispersionNode):Tp;Ui.assign(i)}}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?N(this.clearcoatNormalNode):ip;Ut.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}le("MeshPhysicalNodeMaterial",Lc);class vg extends Go{constructor(e,t,s,o){super(e,t,s),this.useSSS=o}direct({lightDirection:e,lightColor:t,reflectedLight:s},o,r){if(this.useSSS===!0){const i=r.material,{thicknessColorNode:a,thicknessDistortionNode:c,thicknessAmbientNode:u,thicknessAttenuationNode:l,thicknessPowerNode:h,thicknessScaleNode:d}=i,m=e.add(te.mul(c)).normalize(),y=T(Q.dot(m.negate()).saturate().pow(h).mul(d)),x=N(y.add(u).mul(a));s.directDiffuse.addAssign(x.mul(l.mul(t)))}super.direct({lightDirection:e,lightColor:t,reflectedLight:s},o,r)}}class Tg extends Lc{constructor(e){super(e),this.thicknessColorNode=null,this.thicknessDistortionNode=T(.1),this.thicknessAmbientNode=T(0),this.thicknessAttenuationNode=T(.1),this.thicknessPowerNode=T(2),this.thicknessScaleNode=T(10)}get useSSS(){return this.thicknessColorNode!==null}setupLightingModel(){return new vg(this.useClearcoat,this.useSheen,this.useIridescence,this.useSSS)}copy(e){return this.thicknessColorNode=e.thicknessColorNode,this.thicknessDistortionNode=e.thicknessDistortionNode,this.thicknessAmbientNode=e.thicknessAmbientNode,this.thicknessAttenuationNode=e.thicknessAttenuationNode,this.thicknessPowerNode=e.thicknessPowerNode,this.thicknessScaleNode=e.thicknessScaleNode,super.copy(e)}}le("MeshSSSNodeMaterial",Tg);const xg=E(({normal:n,lightDirection:e,builder:t})=>{const s=n.dot(e),o=b(s.mul(.5).add(.5),0);if(t.material.gradientMap){const r=dt("gradientMap","texture").context({getUV:()=>o});return N(r.r)}else{const r=o.fwidth().mul(.5);return re(N(.7),N(1),st(T(.7).sub(r.x),T(.7).add(r.x),o.x))}});class wg extends cn{direct({lightDirection:e,lightColor:t,reflectedLight:s},o,r){const i=xg({normal:Zs,lightDirection:e,builder:r}).mul(t);s.directDiffuse.addAssign(i.mul(Zt({diffuseColor:X.rgb})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(Zt({diffuseColor:X})))}}const bg=new Su;class Sg extends Te{constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(bg),this.setValues(e)}setupLightingModel(){return new wg}}le("MeshToonNodeMaterial",Sg);const Mg=new Mu;class Eg extends Te{constructor(e){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Mg),this.setValues(e)}setupVariants(e){const t=af;let s;e.material.matcap?s=dt("matcap","texture").context({getUV:()=>t}):s=N(re(.2,.8,t.y)),X.rgb.mulAssign(s.rgb)}}le("MeshMatcapNodeMaterial",Eg);const Ag=new ai;class Rg extends Te{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Ag),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}le("PointsNodeMaterial",Rg);const Cg=new Eu;class Lg extends Te{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Cg),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:o,scaleNode:r}=this,i=he;let a=Rt.mul(N(s||0)),c=b(Ns[0].xyz.length(),Ns[1].xyz.length());r!==null&&(c=c.mul(r));let u=i.xy;e.center&&e.center.isVector2===!0&&(u=u.sub(k(e.center).sub(.5))),u=u.mul(c);const l=T(o||ap),h=u.rotate(l);a=L(a.xy.add(h),a.zw);const d=Qe.mul(a);return t.vertex=i,d}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}le("SpriteNodeMaterial",Lg);class Ig extends cn{constructor(){super(),this.shadowNode=T(1).toVar("shadowMask")}direct({shadowMask:e}){this.shadowNode.mulAssign(e)}finish(e){X.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(X.rgb)}}const Og=new Au;class Dg extends Te{constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Og),this.setValues(e)}setupLightingModel(){return new Ig}}le("ShadowNodeMaterial",Dg);class _g extends Te{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.isVolumeNodeMaterial=!0,this.testNode=null,this.setValues(e)}setup(e){const t=wf(this.map,null,0),s=E(({orig:o,dir:r})=>{const i=N(-.5),a=N(.5),c=r.reciprocal(),u=i.sub(o).mul(c),l=a.sub(o).mul(c),h=ut(u,l),d=be(u,l),m=be(h.x,be(h.y,h.z)),y=ut(d.x,ut(d.y,d.z));return b(m,y)});this.fragmentNode=E(()=>{const o=oe(N(qh.mul(L(ta,1)))),i=oe(xe.sub(o)).normalize(),a=ee("vec2","bounds").assign(s({orig:o,dir:i}));a.x.greaterThan(a.y).discard(),a.assign(b(be(a.x,0),a.y));const c=ee("vec3","p").assign(o.add(a.x.mul(i))),u=ee("vec3","inc").assign(N(i.abs().reciprocal())),l=ee("float","delta").assign(ut(u.x,ut(u.y,u.z)));l.divAssign(dt("steps","float"));const h=ee("vec4","ac").assign(L(dt("base","color"),0));return Ye({type:"float",start:a.x,end:a.y,update:"+= delta"},()=>{const d=ee("float","d").assign(t.uv(c.add(.5)).r);this.testNode!==null?this.testNode({map:t,mapValue:d,probe:c,finalColor:h}).append():(h.a.assign(1),ma()),c.addAssign(i.mul(l))}),h.a.equal(0).discard(),L(h)})(),super.setup(e)}}le("VolumeNodeMaterial",_g);const kg=ui.createMaterialFromType;ui.createMaterialFromType=function(n){const e=Oa(n);return e!==void 0?e:kg.call(this,n)};const po=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Qr=[{name:"red",rgb:"#FF0000",darker:"#8B0000"},{name:"blue",rgb:"#0000FF",darker:"#00008B"},{name:"green",rgb:"#00FF00",darker:"#008B00"},{name:"purple",rgb:"#800080",darker:"#4B0082"},{name:"orange",rgb:"#FFA500",darker:"#FF4500"},{name:"yellow",rgb:"#FFFF00",darker:"#ADFF2F"}],Vg=Array.from({length:7},(n,e)=>{const t=(e+7)%7;return Array.from({length:Math.floor(Math.random()*10)},(s,o)=>({day:po[t],EstimatedTimeToComplete:Math.floor(30+Math.random()*120),id:`Task ${e*10+o+1}`,Color:[Qr[Math.floor(Math.random()*Qr.length)].rgb]}))}).flat(),Ug=n=>{const e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],t=Bt.useRef([]),[s,o]=Bt.useState(Vg);Bt.useEffect(()=>{t.current=e.map(()=>Ru.createRef()),Cu().then(i=>{Promise.all(i.map(a=>Lu(a.AssignedCrew).then(c=>({...a,AssignedCrewName:c})))).then(a=>{o(a)})})},[]);const r=(i,a,c)=>{if(t.current[i]&&t.current[i].current){const u=t.current[i].current;u.style.left=`${a}px`,u.style.top=`${c}px`}};return Oe.jsxs(Oe.Fragment,{children:[Oe.jsx("h1",{style:Iu,children:"Week Window"}),Oe.jsx(Ko,{orientation:"vertical",style:{position:"absolute",left:"13%"},sx:{borderLeftWidth:2,borderLeftStyle:"dashed",borderLeftColor:"black",borderRightWidth:0,height:"77%"}}),Oe.jsx(Ou,{style:{position:"relative",top:"5%",width:"85%",left:"15%"},children:po.map(i=>Oe.jsxs("div",{children:[Oe.jsx("h2",{style:{position:"absolute",left:"-15%"},children:i},i),Oe.jsxs(Zo,{container:!0,rowSpacing:{xs:1},columnSpacing:{xs:1},p:2,direction:"row",justifyContent:"flex-start",alignItems:"flex-start",children:[r(po.indexOf(i),0,0),s.filter(a=>a.day===i).map(a=>Oe.jsx(Zo,{item:!0,xs:a.EstimatedTimeToComplete/30,children:Oe.jsx(Du,{sx:{height:40,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:a.Color,transition:"background-color 0.3s","&:hover":{backgroundColor:"white"}},onClick:()=>{n.onButtonClick(a)},children:a.name})},a.id))]}),Oe.jsx(Ko,{sx:{borderBottomWidth:2,borderStyle:"dashed",borderColor:"black"}})]},i))})]})};export{Ug as default};
//# sourceMappingURL=WeekWindow-lzPDjke-.js.map
